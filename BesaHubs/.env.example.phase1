# =============================================================================
# BESAHUBS CRM - PHASE 1 CONFIGURATION
# =============================================================================
# 
# This file contains environment variables required for Phase 1 features:
# 1. SendGrid Email Integration
# 2. Google & Microsoft Calendar Sync
# 3. Advanced Custom Dashboards
#
# Copy this file to .env and fill in your actual values.
# Never commit the .env file to version control!
#
# Last Updated: October 19, 2025
# Version: 1.0.0
# =============================================================================

# =============================================================================
# CORE APPLICATION (Required for base functionality)
# =============================================================================

# Application Environment
NODE_ENV=development                    # Options: development, production, test

# Server Configuration
PORT=3001                              # Backend server port
FRONTEND_URL=http://localhost:3000     # Frontend application URL
CLIENT_URL=http://localhost:3000       # Client-facing URL
CORS_ORIGIN=http://localhost:3000      # CORS allowed origins

# Public URLs (for OAuth callbacks and webhooks)
APP_BASE_URL=http://localhost:3000     # Frontend base URL (for redirects)
API_BASE_URL=http://localhost:3001     # Backend API base URL (for callbacks)

# =============================================================================
# DATABASE (Required)
# =============================================================================

# PostgreSQL Connection
DATABASE_URL=postgresql://username:password@localhost:5432/besahubs_crm

# Alternative database configuration (if not using DATABASE_URL)
# DB_HOST=localhost
# DB_PORT=5432
# DB_NAME=besahubs_crm
# DB_USER=username
# DB_PASSWORD=password
# DB_SSL=false

# =============================================================================
# SECURITY (Required)
# =============================================================================

# JWT Secrets (REQUIRED - Use strong random strings, min 32 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=your-very-secure-jwt-secret-min-32-characters-here
JWT_REFRESH_SECRET=your-different-refresh-secret-min-32-characters-here

# JWT Token Expiration
JWT_EXPIRES_IN=1h                      # Access token expiry (e.g., 15m, 1h, 1d)
JWT_REFRESH_EXPIRES_IN=7d              # Refresh token expiry (e.g., 7d, 30d)

# Encryption Key for PII fields (REQUIRED - min 32 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=your-encryption-key-for-pii-min-32-characters-here

# =============================================================================
# PHASE 1: SENDGRID EMAIL INTEGRATION
# =============================================================================

# Enable SendGrid Integration
# Set to 'true' to activate SendGrid features, 'false' to disable
SENDGRID_ENABLED=true                  # REQUIRED: true or false

# SendGrid API Configuration
# Get API key from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  # REQUIRED if SENDGRID_ENABLED=true

# Sender Information (must be verified in SendGrid)
# Verify sender at: https://app.sendgrid.com/settings/sender_auth
SENDGRID_FROM_EMAIL=noreply@yourdomain.com          # REQUIRED: Verified sender email
SENDGRID_FROM_NAME=BesaHubs CRM                     # REQUIRED: Sender display name

# Webhook Configuration
# Webhook signing key from: https://app.sendgrid.com/settings/mail_settings (Event Webhook section)
# This key is used to verify webhook authenticity (security)
SENDGRID_WEBHOOK_SIGNING_KEY=MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE...  # REQUIRED for webhook verification

# Dynamic Template IDs
# Create templates at: https://app.sendgrid.com/dynamic_templates
# Each template ID starts with 'd-'
SENDGRID_TEMPLATE_INVITE=d-xxxxxxxxxxxxxxxxxxxxx           # REQUIRED: User invitation template
SENDGRID_TEMPLATE_PASSWORD_RESET=d-yyyyyyyyyyyyyyyyyyyyy  # REQUIRED: Password reset template
SENDGRID_TEMPLATE_PROPERTY_PROMO=d-zzzzzzzzzzzzzzzzzzzzz  # REQUIRED: Property promotion template

# Webhook URL (for reference - configured in SendGrid dashboard)
# Production: https://api.yourdomain.com/api/integrations/sendgrid/webhook
# Development: Use ngrok to create public HTTPS tunnel to localhost:3001

# =============================================================================
# PHASE 1: GOOGLE CALENDAR INTEGRATION
# =============================================================================

# Enable Calendar Integration
CALENDAR_ENABLED=true                  # REQUIRED: true or false

# Google Calendar OAuth 2.0 Credentials
# Get credentials from: https://console.cloud.google.com/apis/credentials
# 
# Setup Steps:
# 1. Create project in Google Cloud Console
# 2. Enable Google Calendar API
# 3. Create OAuth 2.0 Client ID (Web application)
# 4. Add authorized redirect URI: http://localhost:3001/api/calendar/google/callback
# 5. Copy Client ID and Client Secret

GOOGLE_CLIENT_ID=123456789-abcdefghijklmnopqrstuvwxyz.apps.googleusercontent.com  # REQUIRED if CALENDAR_ENABLED=true
GOOGLE_CLIENT_SECRET=GOCSPX-xxxxxxxxxxxxxxxxxxxxxxxx                              # REQUIRED if CALENDAR_ENABLED=true
GOOGLE_REDIRECT_URI=http://localhost:3001/api/calendar/google/callback            # REQUIRED: Must match OAuth app config

# Google Calendar API Scopes (automatically requested during OAuth)
# - https://www.googleapis.com/auth/calendar
# - https://www.googleapis.com/auth/calendar.events

# Production Google Redirect URI Example:
# GOOGLE_REDIRECT_URI=https://api.yourdomain.com/api/calendar/google/callback

# =============================================================================
# PHASE 1: MICROSOFT 365 CALENDAR INTEGRATION
# =============================================================================

# Microsoft 365 OAuth 2.0 Credentials
# Get credentials from: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps
#
# Setup Steps:
# 1. Register app in Azure Active Directory
# 2. Add platform: Web
# 3. Add redirect URI: http://localhost:3001/api/calendar/microsoft/callback
# 4. Add API permissions: Calendars.ReadWrite, Calendars.ReadWrite.Shared, User.Read
# 5. Create client secret
# 6. Copy Application (client) ID, Directory (tenant) ID, and Client Secret

MS_CLIENT_ID=12345678-abcd-1234-abcd-123456789012                        # REQUIRED if CALENDAR_ENABLED=true
MS_CLIENT_SECRET=abc~xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx            # REQUIRED if CALENDAR_ENABLED=true
MS_REDIRECT_URI=http://localhost:3001/api/calendar/microsoft/callback    # REQUIRED: Must match Azure AD app config
MS_TENANT_ID=common                                                       # REQUIRED: Use 'common' for all accounts or specific tenant ID

# Microsoft Graph API Scopes (automatically requested during OAuth)
# - Calendars.ReadWrite
# - Calendars.ReadWrite.Shared
# - User.Read
# - offline_access

# Production Microsoft Redirect URI Example:
# MS_REDIRECT_URI=https://api.yourdomain.com/api/calendar/microsoft/callback

# Tenant ID Options:
# - 'common': Allow both personal Microsoft accounts and work/school accounts
# - 'organizations': Only work/school accounts
# - 'consumers': Only personal Microsoft accounts
# - Specific tenant ID: Only that organization (e.g., '12345678-abcd-1234-abcd-123456789012')

# =============================================================================
# PHASE 1: ADVANCED CUSTOM DASHBOARDS
# =============================================================================

# Enable Dashboards Feature
# No additional configuration required - just enable the feature!
DASHBOARDS_ENABLED=true                # REQUIRED: true or false

# Dashboard Configuration (Optional)
# DASHBOARD_MAX_WIDGETS_PER_DASHBOARD=20     # Max widgets per dashboard (default: 20)
# DASHBOARD_QUERY_TIMEOUT=30000              # Query timeout in ms (default: 30000)
# DASHBOARD_CACHE_TTL=300                    # Cache TTL in seconds (default: 300)

# =============================================================================
# OPTIONAL: ADDITIONAL INTEGRATIONS
# =============================================================================

# Redis (Optional - for caching and rate limiting)
# REDIS_URL=redis://localhost:6379
# REDIS_PASSWORD=your-redis-password
# REDIS_TLS=false

# Rate Limiting (Optional)
# RATE_LIMIT_WINDOW_MS=900000           # 15 minutes in ms
# RATE_LIMIT_MAX_REQUESTS=100           # Max requests per window

# Session Configuration (Optional)
# SESSION_SECRET=your-session-secret
# SESSION_MAX_AGE=86400000              # 24 hours in ms

# =============================================================================
# OPTIONAL: SMTP EMAIL (Alternative to SendGrid)
# =============================================================================
# If not using SendGrid, you can use standard SMTP for basic email sending
# Note: SMTP doesn't support advanced features like webhook tracking

# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false                     # true for port 465, false for other ports
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password
# SMTP_FROM=noreply@yourdomain.com
# SMTP_FROM_NAME=BesaHubs CRM

# =============================================================================
# OPTIONAL: LOGGING & MONITORING
# =============================================================================

# Logging Level
LOG_LEVEL=info                         # Options: error, warn, info, debug, silly

# Log File Configuration
# LOG_DIR=logs
# LOG_FILE_MAX_SIZE=20m
# LOG_FILE_MAX_FILES=14d

# =============================================================================
# DEVELOPMENT SETTINGS (Development only - disable in production!)
# =============================================================================

# Demo Mode (allows login with demo credentials - DISABLE IN PRODUCTION)
# DEMO_MODE=true
# DEMO_EMAIL=admin@demo.com
# DEMO_PASSWORD=admin123

# Debug Mode
# DEBUG=true
# DEBUG_SQL=false                       # Log all SQL queries

# Disable Security Features (Development only - NEVER in production!)
# DISABLE_RATE_LIMIT=true
# DISABLE_HELMET=true
# ALLOW_INSECURE_COOKIES=true

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# 
# Before deploying to production:
# 
# 1. Environment
#    ✅ Set NODE_ENV=production
#    ✅ Use production database URL
#    ✅ Set FRONTEND_URL and CLIENT_URL to production domains
# 
# 2. Security
#    ✅ Generate strong JWT_SECRET and JWT_REFRESH_SECRET (32+ chars)
#    ✅ Generate strong ENCRYPTION_KEY (32+ chars)
#    ✅ Never commit .env file to version control
#    ✅ Use environment variable managers (AWS Secrets Manager, Azure Key Vault, etc.)
#    ✅ Disable DEMO_MODE
#    ✅ Disable DEBUG mode
#    ✅ Enable all security features (rate limiting, helmet, secure cookies)
# 
# 3. SendGrid
#    ✅ Use production API key (not test key)
#    ✅ Verify sender domain (not just email)
#    ✅ Configure webhook URL with HTTPS
#    ✅ Enable webhook signature verification
#    ✅ Test all email templates
# 
# 4. Calendar Integration
#    ✅ Update OAuth redirect URIs to production URLs (HTTPS)
#    ✅ For Google: Update authorized redirect URIs in Google Cloud Console
#    ✅ For Microsoft: Update redirect URIs in Azure AD
#    ✅ Rotate OAuth credentials regularly
#    ✅ Consider using organization-specific tenant ID for Microsoft
# 
# 5. SSL/TLS
#    ✅ Use HTTPS for all URLs (APP_BASE_URL, API_BASE_URL)
#    ✅ Use HTTPS for OAuth redirect URIs
#    ✅ Use HTTPS for webhook URLs
#    ✅ Enable secure cookies
# 
# 6. Monitoring
#    ✅ Set up error tracking (Sentry, Rollbar, etc.)
#    ✅ Configure log aggregation (CloudWatch, Datadog, etc.)
#    ✅ Set up uptime monitoring
#    ✅ Enable audit logging
# 
# =============================================================================
# DOCUMENTATION LINKS
# =============================================================================
# 
# Phase 1 Documentation:
# - Full documentation: docs/PHASE1.md
# - Postman collection: docs/postman/BesaHubs-Phase1.postman_collection.json
# - Main README: README.md
# 
# External Resources:
# - SendGrid Documentation: https://docs.sendgrid.com/
# - Google Calendar API: https://developers.google.com/calendar
# - Microsoft Graph API: https://learn.microsoft.com/en-us/graph/api/resources/calendar
# - Google Cloud Console: https://console.cloud.google.com/
# - Azure Portal: https://portal.azure.com/
# 
# =============================================================================
# SUPPORT
# =============================================================================
# 
# For issues or questions:
# 1. Check docs/PHASE1.md troubleshooting section
# 2. Review server logs for error messages
# 3. Test endpoints using Postman collection
# 4. Contact your development team
# 
# =============================================================================
