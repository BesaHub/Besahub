"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[3641],{19252:(e,t,a)=>{a.d(t,{A:()=>y});var n=a(98587),r=a(58168),o=a(65043),i=a(58387),s=a(72372),d=a(98610),l=a(67598),c=a(52900),u=a(46060),m=a(18280),p=a(70579);const x=["className","component","disableGutters","fixed","maxWidth","classes"],h=(0,m.A)(),b=(0,u.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,t["maxWidth".concat((0,l.A)(String(a.maxWidth)))],a.fixed&&t.fixed,a.disableGutters&&t.disableGutters]}}),f=e=>(0,c.A)({props:e,name:"MuiContainer",defaultTheme:h});var v=a(6803),g=a(34535),A=a(98206);const k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=b,useThemeProps:a=f,componentName:c="MuiContainer"}=e,u=t(e=>{let{theme:t,ownerState:a}=e;return(0,r.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!a.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})},e=>{let{theme:t,ownerState:a}=e;return a.fixed&&Object.keys(t.breakpoints.values).reduce((e,a)=>{const n=a,r=t.breakpoints.values[n];return 0!==r&&(e[t.breakpoints.up(n)]={maxWidth:"".concat(r).concat(t.breakpoints.unit)}),e},{})},e=>{let{theme:t,ownerState:a}=e;return(0,r.A)({},"xs"===a.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},a.maxWidth&&"xs"!==a.maxWidth&&{[t.breakpoints.up(a.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[a.maxWidth]).concat(t.breakpoints.unit)}})}),m=o.forwardRef(function(e,t){const o=a(e),{className:m,component:h="div",disableGutters:b=!1,fixed:f=!1,maxWidth:v="lg"}=o,g=(0,n.A)(o,x),A=(0,r.A)({},o,{component:h,disableGutters:b,fixed:f,maxWidth:v}),k=((e,t)=>{const{classes:a,fixed:n,disableGutters:r,maxWidth:o}=e,i={root:["root",o&&"maxWidth".concat((0,l.A)(String(o))),n&&"fixed",r&&"disableGutters"]};return(0,d.A)(i,e=>(0,s.Ay)(t,e),a)})(A,c);return(0,p.jsx)(u,(0,r.A)({as:h,ownerState:A,className:(0,i.A)(k.root,m),ref:t},g))});return m}({createStyledComponent:(0,g.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,t["maxWidth".concat((0,v.A)(String(a.maxWidth)))],a.fixed&&t.fixed,a.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,A.b)({props:e,name:"MuiContainer"})}),y=k},33641:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var n=a(65043),r=a(73216),o=a(96446),i=a(19252),s=a(63336),d=a(85865),l=a(67254),c=a(29013),u=a(24056),m=a(67784),p=a(11906),x=a(81637),h=a(88446),b=a(93234),f=a(94505),v=a(35016),g=a(70579);const A=()=>{var e;const t=(0,r.Zp)(),a=(0,r.zy)(),{setAuthData:A}=(0,v.h)(),[k,y]=(0,n.useState)(0),[j,S]=(0,n.useState)(""),[C,W]=(0,n.useState)(""),[w,T]=(0,n.useState)(!1),[z,G]=(0,n.useState)(""),R=(null===(e=a.state)||void 0===e?void 0:e.tempToken)||"";n.useEffect(()=>{R||t("/login")},[R,t]);return(0,g.jsx)(o.A,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)",display:"flex",alignItems:"center",justifyContent:"center",py:3},children:(0,g.jsx)(i.A,{maxWidth:"sm",children:(0,g.jsxs)(s.A,{elevation:10,sx:{p:4,borderRadius:3},children:[(0,g.jsxs)(o.A,{sx:{textAlign:"center",mb:3},children:[(0,g.jsx)(b.A,{sx:{fontSize:60,color:"primary.main",mb:2}}),(0,g.jsx)(d.A,{variant:"h4",gutterBottom:!0,children:"Two-Factor Authentication"}),(0,g.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"Enter the verification code from your authenticator app"})]}),z&&(0,g.jsx)(l.A,{severity:"error",sx:{mb:3},children:z}),(0,g.jsxs)(c.A,{value:k,onChange:(e,t)=>{y(t),G(""),S(""),W("")},sx:{mb:3,borderBottom:1,borderColor:"divider"},children:[(0,g.jsx)(u.A,{label:"Authenticator App"}),(0,g.jsx)(u.A,{label:"Backup Code"})]}),0===k&&(0,g.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),6===j.length)try{T(!0),G("");const e=await f.Ay.post("/mfa/verify",{tempToken:R,token:j});localStorage.setItem("token",e.data.token),localStorage.setItem("refreshToken",e.data.refreshToken),A&&A({user:e.data.user,token:e.data.token}),t("/dashboard")}catch(o){var a,n,r;console.error("MFA verification error:",o);const e=(null===(a=o.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Invalid verification code";G(e),401===(null===(r=o.response)||void 0===r?void 0:r.status)&&e.includes("expired")&&setTimeout(()=>t("/login"),2e3)}finally{T(!1)}else G("Please enter a 6-digit code")},children:(0,g.jsxs)(o.A,{sx:{textAlign:"center"},children:[(0,g.jsx)(m.A,{label:"Verification Code",value:j,onChange:e=>S(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",inputProps:{maxLength:6,style:{textAlign:"center",fontSize:"2rem",letterSpacing:"0.5rem",fontFamily:"monospace"}},sx:{width:300,my:3},autoFocus:!0,required:!0}),(0,g.jsx)(p.A,{type:"submit",variant:"contained",size:"large",fullWidth:!0,disabled:w||6!==j.length,sx:{mb:2},children:w?(0,g.jsx)(x.A,{size:24}):"Verify"})]})}),1===k&&(0,g.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),C.trim())try{T(!0),G("");const e=await f.Ay.post("/mfa/backup-codes/verify",{tempToken:R,backupCode:C.toUpperCase()});localStorage.setItem("token",e.data.token),localStorage.setItem("refreshToken",e.data.refreshToken),A&&A({user:e.data.user,token:e.data.token}),e.data.warning&&alert(e.data.warning),t("/dashboard")}catch(o){var a,n,r;console.error("Backup code verification error:",o);const e=(null===(a=o.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Invalid backup code";G(e),401===(null===(r=o.response)||void 0===r?void 0:r.status)&&e.includes("expired")&&setTimeout(()=>t("/login"),2e3)}finally{T(!1)}else G("Please enter a backup code")},children:(0,g.jsxs)(o.A,{children:[(0,g.jsx)(l.A,{severity:"info",sx:{mb:3},children:(0,g.jsx)(d.A,{variant:"body2",children:"Enter one of your backup codes. Each code can only be used once."})}),(0,g.jsx)(m.A,{label:"Backup Code",value:C,onChange:e=>W(e.target.value.toUpperCase()),placeholder:"XXXXXXXX",fullWidth:!0,inputProps:{style:{fontFamily:"monospace",fontSize:"1.2rem",textAlign:"center"}},sx:{mb:3},autoFocus:!0,required:!0}),(0,g.jsx)(p.A,{type:"submit",variant:"contained",size:"large",fullWidth:!0,disabled:w||!C.trim(),children:w?(0,g.jsx)(x.A,{size:24}):"Verify Backup Code"})]})}),(0,g.jsx)(o.A,{sx:{textAlign:"center",mt:3},children:(0,g.jsx)(h.A,{component:"button",variant:"body2",onClick:()=>t("/login"),sx:{cursor:"pointer"},children:"Back to Login"})})]})})})}},93234:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(66734),r=a(70579);const o=(0,n.A)((0,r.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security")}}]);
//# sourceMappingURL=3641.b29330bf.chunk.js.map