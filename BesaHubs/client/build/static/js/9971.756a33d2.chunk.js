"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[9971],{34799:(e,t,a)=>{a.d(t,{Bm:()=>n,M6:()=>r,b5:()=>s,oO:()=>l});var i=a(94505);const n={getCampaigns:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams(e).toString(),a="/campaigns".concat(t?"?".concat(t):"");return(await i.Ay.get(a)).data}catch(t){throw console.error("Error fetching campaigns:",t),t}},getCampaignById:async e=>{try{return(await i.Ay.get("/campaigns/".concat(e))).data}catch(t){throw console.error("Error fetching campaign:",t),t}},createCampaign:async e=>{try{return(await i.Ay.post("/campaigns",e)).data}catch(t){throw console.error("Error creating campaign:",t),t}},updateCampaign:async(e,t)=>{try{return(await i.Ay.put("/campaigns/".concat(e),t)).data}catch(a){throw console.error("Error updating campaign:",a),a}},deleteCampaign:async e=>{try{return(await i.Ay.delete("/campaigns/".concat(e))).data}catch(t){throw console.error("Error deleting campaign:",t),t}},scheduleCampaign:async(e,t)=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/schedule"),{scheduledDate:t})).data}catch(a){throw console.error("Error scheduling campaign:",a),a}},sendCampaign:async e=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/send"))).data}catch(t){throw console.error("Error sending campaign:",t),t}},pauseCampaign:async e=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/pause"))).data}catch(t){throw console.error("Error pausing campaign:",t),t}},cancelCampaign:async e=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/cancel"))).data}catch(t){throw console.error("Error cancelling campaign:",t),t}},getCampaignRecipients:async e=>{try{return(await i.Ay.get("/campaigns/".concat(e,"/recipients"))).data}catch(t){throw console.error("Error fetching campaign recipients:",t),t}},getCampaignAnalytics:async e=>{try{return(await i.Ay.get("/campaigns/".concat(e,"/analytics"))).data}catch(t){throw console.error("Error fetching campaign analytics:",t),t}},sendTestEmail:async(e,t)=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/test"),{email:t})).data}catch(a){throw console.error("Error sending test email:",a),a}},duplicateCampaign:async e=>{try{return(await i.Ay.post("/campaigns/".concat(e,"/duplicate"))).data}catch(t){throw console.error("Error duplicating campaign:",t),t}}},s=[{id:"email",name:"Email",description:"General email campaign"},{id:"newsletter",name:"Newsletter",description:"Regular newsletter"},{id:"property_promo",name:"Property Promotion",description:"Promote properties"},{id:"investor_update",name:"Investor Update",description:"Update for investors"},{id:"event",name:"Event",description:"Event invitation or update"}],r=[{id:"draft",name:"Draft",color:"default"},{id:"scheduled",name:"Scheduled",color:"info"},{id:"sending",name:"Sending",color:"warning"},{id:"sent",name:"Sent",color:"success"},{id:"paused",name:"Paused",color:"warning"},{id:"cancelled",name:"Cancelled",color:"error"}],l=[{id:"all_contacts",name:"All Contacts",description:"Send to all contacts in CRM"},{id:"filtered",name:"Filtered Contacts",description:"Send to contacts matching criteria"},{id:"custom_list",name:"Custom List",description:"Upload or select specific contacts"},{id:"specific",name:"Specific Contacts",description:"Choose individual contacts"}]},39705:(e,t,a)=>{a.d(t,{TP:()=>n});var i=a(94505);const n={getContacts:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams(e).toString(),a="/contacts".concat(t?"?".concat(t):"");return(await i.Ay.get(a)).data}catch(t){throw console.error("Error fetching contacts:",t),t}},getContact:async e=>{try{return(await i.Ay.get("/contacts/".concat(e))).data}catch(t){throw console.error("Error fetching contact:",t),t}},createContact:async e=>{try{return(await i.Ay.post("/contacts",e)).data}catch(t){throw console.error("Error creating contact:",t),t}},updateContact:async(e,t)=>{try{return(await i.Ay.put("/contacts/".concat(e),t)).data}catch(a){throw console.error("Error updating contact:",a),a}},deleteContact:async e=>{try{return(await i.Ay.delete("/contacts/".concat(e))).data}catch(t){throw console.error("Error deleting contact:",t),t}}}},69971:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var i=a(89379),n=a(65043),s=a(73216),r=a(19252),l=a(96446),c=a(81637),o=a(17392),d=a(85865),p=a(11906),m=a(67254),u=a(63336),h=a(29013),g=a(24056),y=a(68903),x=a(67784),A=a(53193),j=a(18356),v=a(72221),f=a(32143),C=a(81673),b=a(43845),w=a(78492),S=a(74605),T=a(16374),E=a(38624),B=a(39336),I=a(83462),z=a(26600),F=a(35316),k=a(29347),D=a(73158),W=a(70141),L=a(87332),P=a(48262),R=a(37141),_=a(41209),q=a(95874),N=a(34799),O=a(39705),M=a(70579);const G=()=>{var e;const{id:t}=(0,s.g)(),a=(0,s.Zp)(),G=(0,s.zy)(),H=!!t,[U,K]=(0,n.useState)(!1),[Y,Z]=(0,n.useState)(!1),[J,Q]=(0,n.useState)(null),[V,X]=(0,n.useState)({open:!1,message:"",severity:"success"}),[$,ee]=(0,n.useState)((null===(e=G.state)||void 0===e?void 0:e.tab)||0),[te,ae]=(0,n.useState)(!1),[ie,ne]=(0,n.useState)(""),[se,re]=(0,n.useState)(!1),[le,ce]=(0,n.useState)({name:"",description:"",type:"email",tags:[],subject:"",emailBody:"",plainTextBody:"",recipientType:"all_contacts",recipientFilters:{leadStatus:[],contactRole:[],tags:[]},recipientList:[],scheduledDate:"",propertyId:"",dealId:""}),[oe,de]=(0,n.useState)({}),[pe,me]=(0,n.useState)(""),[ue,he]=(0,n.useState)([]),[ge,ye]=(0,n.useState)(!1),[xe,Ae]=(0,n.useState)(0),[je,ve]=(0,n.useState)([]);(0,n.useEffect)(()=>{H&&fe()},[t,H]),(0,n.useEffect)(()=>{2===$&&Ce()},[$]),(0,n.useEffect)(()=>{be()},[le.recipientType,le.recipientFilters,le.recipientList,je]);const fe=async()=>{try{K(!0);const e=await N.Bm.getCampaignById(t);if(e&&e.campaign){const t=e.campaign;ce({name:t.name||"",description:t.description||"",type:t.type||"email",tags:t.tags||[],subject:t.subject||"",emailBody:t.emailBody||"",plainTextBody:t.plainTextBody||"",recipientType:t.recipientType||"all_contacts",recipientFilters:t.recipientFilters||{leadStatus:[],contactRole:[],tags:[]},recipientList:t.recipientList||[],scheduledDate:t.scheduledDate?new Date(t.scheduledDate).toISOString().slice(0,16):"",propertyId:t.propertyId||"",dealId:t.dealId||""})}}catch(e){Q("Failed to load campaign details"),console.error("Error fetching campaign:",e)}finally{K(!1)}},Ce=async()=>{try{ye(!0);const e=await O.TP.getContacts({limit:1e3});he(e.contacts||[])}catch(e){console.error("Error fetching contacts:",e)}finally{ye(!1)}},be=()=>{let e=0;"all_contacts"===le.recipientType?e=ue.length:"filtered"===le.recipientType?e=ue.filter(e=>{var t,a,i;let n=!0;return(null===(t=le.recipientFilters.leadStatus)||void 0===t?void 0:t.length)>0&&(n=n&&le.recipientFilters.leadStatus.includes(e.leadStatus)),(null===(a=le.recipientFilters.contactRole)||void 0===a?void 0:a.length)>0&&(n=n&&le.recipientFilters.contactRole.includes(e.contactRole)),(null===(i=le.recipientFilters.tags)||void 0===i?void 0:i.length)>0&&(n=n&&le.recipientFilters.tags.some(t=>{var a;return null===(a=e.tags)||void 0===a?void 0:a.includes(t)})),n}).length:"custom_list"===le.recipientType?e=le.recipientList.length:"specific"===le.recipientType&&(e=je.length),Ae(e)},we=e=>t=>{const a=t.target.value;ce(t=>(0,i.A)((0,i.A)({},t),{},{[e]:a})),oe[e]&&de(t=>(0,i.A)((0,i.A)({},t),{},{[e]:null}))},Se=()=>{pe.trim()&&!le.tags.includes(pe.trim())&&(ce(e=>(0,i.A)((0,i.A)({},e),{},{tags:[...e.tags,pe.trim()]})),me(""))},Te=(e,t)=>{ce(a=>(0,i.A)((0,i.A)({},a),{},{recipientFilters:(0,i.A)((0,i.A)({},a.recipientFilters),{},{[e]:t})}))},Ee=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"save";if(!(()=>{const e={};return le.name.trim()||(e.name="Campaign name is required"),le.type||(e.type="Campaign type is required"),le.subject.trim()||(e.subject="Email subject is required"),le.emailBody.trim()||(e.emailBody="Email body is required"),"specific"===le.recipientType&&0===je.length&&(e.recipients="Please select at least one recipient"),de(e),0===Object.keys(e).length})())return X({open:!0,message:"Please fix the errors before submitting",severity:"error"}),void ee(0);try{var n;Z(!0);const s=(0,i.A)((0,i.A)({},le),{},{recipientList:"specific"===le.recipientType?je.map(e=>e.id):le.recipientList});let r;r=H?await N.Bm.updateCampaign(t,s):await N.Bm.createCampaign(s);const l=(null===(n=r.campaign)||void 0===n?void 0:n.id)||t;"schedule"===e&&le.scheduledDate?(await N.Bm.scheduleCampaign(l,le.scheduledDate),X({open:!0,message:"Campaign scheduled successfully",severity:"success"})):"send"===e?(await N.Bm.sendCampaign(l),X({open:!0,message:"Campaign sent successfully (SendGrid integration pending)",severity:"info"})):X({open:!0,message:"Campaign ".concat(H?"updated":"created"," successfully"),severity:"success"}),setTimeout(()=>a("/campaigns"),1500)}catch(l){var s,r;X({open:!0,message:(null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to ".concat(e," campaign"),severity:"error"})}finally{Z(!1)}};return U?(0,M.jsx)(r.A,{maxWidth:"lg",sx:{py:4},children:(0,M.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:(0,M.jsx)(c.A,{})})}):(0,M.jsxs)(r.A,{maxWidth:"lg",sx:{py:2},children:[(0,M.jsxs)(l.A,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,M.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,M.jsx)(o.A,{onClick:()=>a("/campaigns"),size:"small",children:(0,M.jsx)(L.A,{})}),(0,M.jsx)(d.A,{variant:"h5",sx:{fontWeight:600},children:H?"Edit Campaign":"Create Campaign"})]}),(0,M.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[H&&(0,M.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,M.jsx)(P.A,{}),onClick:()=>ae(!0),children:"Send Test"}),(0,M.jsx)(p.A,{variant:"outlined",size:"small",onClick:()=>a("/campaigns"),children:"Cancel"}),(0,M.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,M.jsx)(R.A,{}),onClick:()=>Ee("save"),disabled:Y,children:"Save Draft"}),le.scheduledDate&&(0,M.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,M.jsx)(_.A,{}),onClick:()=>Ee("schedule"),disabled:Y,children:"Schedule"}),(0,M.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,M.jsx)(q.A,{}),onClick:()=>Ee("send"),disabled:Y,children:"Send Now"})]})]}),J&&(0,M.jsx)(m.A,{severity:"error",sx:{mb:2},onClose:()=>Q(null),children:J}),(0,M.jsx)(u.A,{sx:{mb:2},children:(0,M.jsxs)(h.A,{value:$,onChange:(e,t)=>ee(t),variant:"fullWidth",children:[(0,M.jsx)(g.A,{label:"Basic Info"}),(0,M.jsx)(g.A,{label:"Email Content"}),(0,M.jsx)(g.A,{label:"Recipients"}),(0,M.jsx)(g.A,{label:"Settings"})]})}),(0,M.jsxs)(u.A,{sx:{p:2},children:[0===$&&(0,M.jsxs)(y.Ay,{container:!0,spacing:2,children:[(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(x.A,{fullWidth:!0,required:!0,size:"small",label:"Campaign Name",value:le.name,onChange:we("name"),error:Boolean(oe.name),helperText:oe.name})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsxs)(A.A,{fullWidth:!0,required:!0,size:"small",error:Boolean(oe.type),children:[(0,M.jsx)(j.A,{children:"Campaign Type"}),(0,M.jsx)(v.A,{value:le.type,label:"Campaign Type",onChange:we("type"),children:N.b5.map(e=>(0,M.jsx)(f.A,{value:e.id,children:e.name},e.id))}),oe.type&&(0,M.jsx)(C.A,{children:oe.type})]})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(x.A,{fullWidth:!0,multiline:!0,rows:3,size:"small",label:"Description",value:le.description,onChange:we("description")})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsxs)(l.A,{children:[(0,M.jsx)(d.A,{variant:"body2",sx:{mb:1},children:"Tags"}),(0,M.jsx)(l.A,{sx:{display:"flex",gap:1,mb:1,flexWrap:"wrap"},children:le.tags.map((e,t)=>(0,M.jsx)(b.A,{label:e,size:"small",onDelete:()=>{return t=e,void ce(e=>(0,i.A)((0,i.A)({},e),{},{tags:e.tags.filter(e=>e!==t)}));var t}},t))}),(0,M.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,M.jsx)(x.A,{fullWidth:!0,size:"small",placeholder:"Add tag...",value:pe,onChange:e=>me(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Se())}}),(0,M.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,M.jsx)(W.A,{}),onClick:Se,children:"Add"})]})]})})]}),1===$&&(0,M.jsxs)(y.Ay,{container:!0,spacing:2,children:[(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(x.A,{fullWidth:!0,required:!0,size:"small",label:"Email Subject",value:le.subject,onChange:we("subject"),error:Boolean(oe.subject),helperText:oe.subject})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(x.A,{fullWidth:!0,required:!0,multiline:!0,rows:12,size:"small",label:"Email Body (HTML supported)",value:le.emailBody,onChange:we("emailBody"),error:Boolean(oe.emailBody),helperText:oe.emailBody||"You can use HTML tags for formatting"})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(x.A,{fullWidth:!0,multiline:!0,rows:6,size:"small",label:"Plain Text Fallback (Optional)",value:le.plainTextBody,onChange:we("plainTextBody"),helperText:"Plain text version for email clients that don't support HTML"})})]}),2===$&&(0,M.jsxs)(y.Ay,{container:!0,spacing:2,children:[(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsxs)(A.A,{component:"fieldset",children:[(0,M.jsx)(d.A,{variant:"body2",sx:{mb:1,fontWeight:600},children:"Recipient Type"}),(0,M.jsx)(w.A,{value:le.recipientType,onChange:e=>{ce(t=>(0,i.A)((0,i.A)({},t),{},{recipientType:e.target.value}))},children:N.oO.map(e=>(0,M.jsx)(S.A,{value:e.id,control:(0,M.jsx)(T.A,{size:"small"}),label:(0,M.jsxs)(l.A,{children:[(0,M.jsx)(d.A,{variant:"body2",children:e.name}),(0,M.jsx)(d.A,{variant:"caption",color:"text.secondary",children:e.description})]})},e.id))})]})}),"filtered"===le.recipientType&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsx)(E.A,{multiple:!0,size:"small",options:["cold","warm","hot","qualified","converted","lost"],value:le.recipientFilters.leadStatus,onChange:(e,t)=>Te("leadStatus",t),renderInput:e=>(0,M.jsx)(x.A,(0,i.A)((0,i.A)({},e),{},{label:"Filter by Lead Status"}))})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsx)(E.A,{multiple:!0,size:"small",options:["tenant","landlord","buyer","seller","investor","broker","attorney","lender","contractor","architect","property_manager","other"],value:le.recipientFilters.contactRole,onChange:(e,t)=>Te("contactRole",t),renderInput:e=>(0,M.jsx)(x.A,(0,i.A)((0,i.A)({},e),{},{label:"Filter by Contact Role"}))})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(E.A,{multiple:!0,size:"small",freeSolo:!0,options:[],value:le.recipientFilters.tags,onChange:(e,t)=>Te("tags",t),renderInput:e=>(0,M.jsx)(x.A,(0,i.A)((0,i.A)({},e),{},{label:"Filter by Tags"}))})})]}),"specific"===le.recipientType&&(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(E.A,{multiple:!0,size:"small",options:ue,value:je,onChange:(e,t)=>ve(t),getOptionLabel:e=>"individual"===e.type?"".concat(e.firstName," ").concat(e.lastName):e.companyName,loading:ge,renderInput:e=>(0,M.jsx)(x.A,(0,i.A)((0,i.A)({},e),{},{label:"Select Contacts",error:Boolean(oe.recipients),helperText:oe.recipients}))})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(m.A,{severity:"info",children:(0,M.jsxs)(d.A,{variant:"body2",sx:{fontWeight:600},children:["Estimated Recipients: ",xe]})})})]}),3===$&&(0,M.jsxs)(y.Ay,{container:!0,spacing:2,children:[(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsx)(x.A,{fullWidth:!0,type:"datetime-local",size:"small",label:"Schedule Date & Time",value:le.scheduledDate,onChange:we("scheduledDate"),InputLabelProps:{shrink:!0},helperText:"Leave empty to save as draft"})}),(0,M.jsxs)(y.Ay,{item:!0,xs:12,children:[(0,M.jsx)(B.A,{sx:{my:1}}),(0,M.jsx)(d.A,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Associated Property/Deal (Optional)"})]}),(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsx)(x.A,{fullWidth:!0,size:"small",label:"Property ID",value:le.propertyId,onChange:we("propertyId"),helperText:"Link this campaign to a specific property"})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,md:6,children:(0,M.jsx)(x.A,{fullWidth:!0,size:"small",label:"Deal ID",value:le.dealId,onChange:we("dealId"),helperText:"Link this campaign to a specific deal"})}),(0,M.jsx)(y.Ay,{item:!0,xs:12,children:(0,M.jsx)(m.A,{severity:"warning",children:(0,M.jsxs)(d.A,{variant:"body2",children:[(0,M.jsx)("strong",{children:"Note:"})," Email sending functionality requires SendGrid integration. Campaigns will be saved and tracked, but actual email delivery will be enabled after SendGrid setup."]})})})]}),(0,M.jsxs)(l.A,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[(0,M.jsx)(p.A,{variant:"outlined",size:"small",onClick:()=>ee(Math.max(0,$-1)),disabled:0===$,children:"Previous"}),(0,M.jsx)(p.A,{variant:"contained",size:"small",onClick:()=>{3===$?Ee("save"):ee(Math.min(3,$+1))},children:3===$?"Save Campaign":"Next"})]})]}),(0,M.jsxs)(I.A,{open:te,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[(0,M.jsx)(z.A,{children:"Send Test Email"}),(0,M.jsx)(F.A,{children:(0,M.jsx)(x.A,{fullWidth:!0,autoFocus:!0,size:"small",type:"email",label:"Test Email Address",value:ie,onChange:e=>ne(e.target.value),sx:{mt:1}})}),(0,M.jsxs)(k.A,{children:[(0,M.jsx)(p.A,{onClick:()=>ae(!1),children:"Cancel"}),(0,M.jsx)(p.A,{variant:"contained",onClick:async()=>{if(ie.trim())try{re(!0),await N.Bm.sendTestEmail(t,ie),X({open:!0,message:"Test email sent successfully (SendGrid integration pending)",severity:"info"}),ae(!1),ne("")}catch(e){X({open:!0,message:"Failed to send test email",severity:"error"})}finally{re(!1)}else X({open:!0,message:"Please enter an email address",severity:"error"})},disabled:se,children:"Send Test"})]})]}),(0,M.jsx)(D.A,{open:V.open,autoHideDuration:6e3,onClose:()=>X((0,i.A)((0,i.A)({},V),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,M.jsx)(m.A,{onClose:()=>X((0,i.A)((0,i.A)({},V),{},{open:!1})),severity:V.severity,sx:{width:"100%"},children:V.message})})]})}}}]);
//# sourceMappingURL=9971.756a33d2.chunk.js.map