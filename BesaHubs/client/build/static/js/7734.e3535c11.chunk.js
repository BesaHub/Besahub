"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[7734],{19252:(t,e,a)=>{a.d(e,{A:()=>S});var n=a(98587),s=a(58168),i=a(65043),o=a(58387),r=a(72372),c=a(98610),l=a(67598),d=a(52900),u=a(46060),m=a(18280),A=a(70579);const x=["className","component","disableGutters","fixed","maxWidth","classes"],f=(0,m.A)(),h=(0,u.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e["maxWidth".concat((0,l.A)(String(a.maxWidth)))],a.fixed&&e.fixed,a.disableGutters&&e.disableGutters]}}),p=t=>(0,d.A)({props:t,name:"MuiContainer",defaultTheme:f});var v=a(6803),y=a(34535),g=a(98206);const b=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:e=h,useThemeProps:a=p,componentName:d="MuiContainer"}=t,u=e(t=>{let{theme:e,ownerState:a}=t;return(0,s.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!a.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}})},t=>{let{theme:e,ownerState:a}=t;return a.fixed&&Object.keys(e.breakpoints.values).reduce((t,a)=>{const n=a,s=e.breakpoints.values[n];return 0!==s&&(t[e.breakpoints.up(n)]={maxWidth:"".concat(s).concat(e.breakpoints.unit)}),t},{})},t=>{let{theme:e,ownerState:a}=t;return(0,s.A)({},"xs"===a.maxWidth&&{[e.breakpoints.up("xs")]:{maxWidth:Math.max(e.breakpoints.values.xs,444)}},a.maxWidth&&"xs"!==a.maxWidth&&{[e.breakpoints.up(a.maxWidth)]:{maxWidth:"".concat(e.breakpoints.values[a.maxWidth]).concat(e.breakpoints.unit)}})}),m=i.forwardRef(function(t,e){const i=a(t),{className:m,component:f="div",disableGutters:h=!1,fixed:p=!1,maxWidth:v="lg"}=i,y=(0,n.A)(i,x),g=(0,s.A)({},i,{component:f,disableGutters:h,fixed:p,maxWidth:v}),b=((t,e)=>{const{classes:a,fixed:n,disableGutters:s,maxWidth:i}=t,o={root:["root",i&&"maxWidth".concat((0,l.A)(String(i))),n&&"fixed",s&&"disableGutters"]};return(0,c.A)(o,t=>(0,r.Ay)(e,t),a)})(g,d);return(0,A.jsx)(u,(0,s.A)({as:f,ownerState:g,className:(0,o.A)(b.root,m),ref:e},y))});return m}({createStyledComponent:(0,y.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e["maxWidth".concat((0,v.A)(String(a.maxWidth)))],a.fixed&&e.fixed,a.disableGutters&&e.disableGutters]}}),useThemeProps:t=>(0,g.b)({props:t,name:"MuiContainer"})}),S=b},23851:(t,e,a)=>{a.d(e,{A:()=>p});var n=a(98587),s=a(58168),i=a(65043),o=a(58387),r=a(98610),c=a(51347),l=a(34535),d=a(98206),u=a(92532),m=a(72372);function A(t){return(0,m.Ay)("MuiListItemAvatar",t)}(0,u.A)("MuiListItemAvatar",["root","alignItemsFlexStart"]);var x=a(70579);const f=["className"],h=(0,l.Ay)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,"flex-start"===a.alignItems&&e.alignItemsFlexStart]}})(t=>{let{ownerState:e}=t;return(0,s.A)({minWidth:56,flexShrink:0},"flex-start"===e.alignItems&&{marginTop:8})}),p=i.forwardRef(function(t,e){const a=(0,d.b)({props:t,name:"MuiListItemAvatar"}),{className:l}=a,u=(0,n.A)(a,f),m=i.useContext(c.A),p=(0,s.A)({},a,{alignItems:m.alignItems}),v=(t=>{const{alignItems:e,classes:a}=t,n={root:["root","flex-start"===e&&"alignItemsFlexStart"]};return(0,r.A)(n,A,a)})(p);return(0,x.jsx)(h,(0,s.A)({className:(0,o.A)(v.root,l),ownerState:p,ref:e},u))})},51387:(t,e,a)=>{a.d(e,{A:()=>i});var n=a(66734),s=a(70579);const i=(0,n.A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},65353:(t,e,a)=>{a.r(e),a.d(e,{default:()=>B});var n=a(89379),s=a(65043),i=a(73216),o=a(19252),r=a(81637),c=a(96446),l=a(85865),d=a(43845),u=a(11906),m=a(67254),A=a(63336),x=a(29013),f=a(24056),h=a(35721),p=a(24628),v=a(17392),y=a(23851),g=a(81045),b=a(48734),S=a(58823),j=a(15337),w=a(59275),D=a(75155),k=a(95846),R=a(75626),C=a(98606),M=a(51387),T=a(35016),_=a(94505);const E={getNotifications:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{limit:e=20,offset:a=0,status:n,type:s}=t,i=new URLSearchParams({limit:e,offset:a});n&&i.append("status",n),s&&i.append("type",s);return(await _.Ay.get("/notifications?".concat(i))).data},getUnreadCount:async()=>(await _.Ay.get("/notifications/unread-count")).data.count,getNotification:async t=>(await _.Ay.get("/notifications/".concat(t))).data,markAsRead:async t=>(await _.Ay.patch("/notifications/".concat(t),{status:"read"})).data,markAllAsRead:async()=>(await _.Ay.post("/notifications/mark-all-read")).data,archiveNotification:async t=>(await _.Ay.delete("/notifications/".concat(t))).data};var I=a(92239),W=a(76321),N=a(74301),G=a(53162),L=a(39321),P=a(16260),O=a(33775);var X=a(54967),U=a(43666),F=43200;function H(t,e,a){var n,s;(0,U.A)(2,arguments);var i=(0,I.q)(),o=null!==(n=null!==(s=null===a||void 0===a?void 0:a.locale)&&void 0!==s?s:i.locale)&&void 0!==n?n:L.A;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var r=(0,W.A)(t,e);if(isNaN(r))throw new RangeError("Invalid time value");var c,l,d,u=(0,O.A)((c=a,(0,O.A)({},c)),{addSuffix:Boolean(null===a||void 0===a?void 0:a.addSuffix),comparison:r});r>0?(l=(0,P.A)(e),d=(0,P.A)(t)):(l=(0,P.A)(t),d=(0,P.A)(e));var m,A=(0,G.A)(d,l),x=((0,X.A)(d)-(0,X.A)(l))/1e3,f=Math.round((A-x)/60);if(f<2)return null!==a&&void 0!==a&&a.includeSeconds?A<5?o.formatDistance("lessThanXSeconds",5,u):A<10?o.formatDistance("lessThanXSeconds",10,u):A<20?o.formatDistance("lessThanXSeconds",20,u):A<40?o.formatDistance("halfAMinute",0,u):A<60?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",1,u):0===f?o.formatDistance("lessThanXMinutes",1,u):o.formatDistance("xMinutes",f,u);if(f<45)return o.formatDistance("xMinutes",f,u);if(f<90)return o.formatDistance("aboutXHours",1,u);if(f<1440){var h=Math.round(f/60);return o.formatDistance("aboutXHours",h,u)}if(f<2520)return o.formatDistance("xDays",1,u);if(f<F){var p=Math.round(f/1440);return o.formatDistance("xDays",p,u)}if(f<86400)return m=Math.round(f/F),o.formatDistance("aboutXMonths",m,u);if((m=(0,N.A)(d,l))<12){var v=Math.round(f/F);return o.formatDistance("xMonths",v,u)}var y=m%12,g=Math.floor(m/12);return y<3?o.formatDistance("aboutXYears",g,u):y<9?o.formatDistance("overXYears",g,u):o.formatDistance("almostXYears",g+1,u)}function z(t,e){return(0,U.A)(1,arguments),H(t,Date.now(),e)}var Y=a(42104),K=a(70579);const B=()=>{const t=(0,i.Zp)(),{user:e}=(0,T.h)(),[a,_]=(0,s.useState)([]),[I,W]=(0,s.useState)(!0),[N,G]=(0,s.useState)(null),[L,P]=(0,s.useState)("all"),[O,X]=(0,s.useState)(0),U=(0,s.useCallback)(async()=>{try{W(!0);const t="all"===L?null:L,e=await E.getNotifications({status:t,limit:50});_(e.notifications||[]);const a=await E.getUnreadCount();X(a)}catch(t){G("Failed to load notifications")}finally{W(!1)}},[L]);(0,s.useEffect)(()=>{U()},[U]),(0,s.useEffect)(()=>{const t=(0,Y.Ay)({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:3001",{auth:{token:localStorage.getItem("token")}});return t.emit("join_user_room",null===e||void 0===e?void 0:e.id),t.on("notification:new",t=>{_(e=>[t,...e]),X(t=>t+1)}),t.on("notification:update",t=>{_(e=>e.map(e=>e.id===t.id?t:e)),"read"===t.status&&X(t=>Math.max(0,t-1))}),()=>t.disconnect()},[e]);const F=async t=>{try{await E.markAsRead(t),_(e=>e.map(e=>e.id===t?(0,n.A)((0,n.A)({},e),{},{status:"read",readAt:new Date}):e)),X(t=>Math.max(0,t-1))}catch(e){G("Failed to mark as read")}};return I?(0,K.jsx)(o.A,{maxWidth:"lg",sx:{mt:4,display:"flex",justifyContent:"center"},children:(0,K.jsx)(r.A,{})}):(0,K.jsxs)(o.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,K.jsxs)(c.A,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)(l.A,{variant:"h4",sx:{fontWeight:600},children:["Notifications",O>0&&(0,K.jsx)(d.A,{label:O,color:"error",size:"small",sx:{ml:2}})]}),O>0&&(0,K.jsx)(u.A,{variant:"outlined",onClick:async()=>{try{await E.markAllAsRead(),_(t=>t.map(t=>(0,n.A)((0,n.A)({},t),{},{status:"read",readAt:new Date}))),X(0)}catch(t){G("Failed to mark all as read")}},startIcon:(0,K.jsx)(C.A,{}),children:"Mark All as Read"})]}),N&&(0,K.jsx)(m.A,{severity:"error",sx:{mb:2},onClose:()=>G(null),children:N}),(0,K.jsx)(A.A,{sx:{mb:3},children:(0,K.jsxs)(x.A,{value:L,onChange:(t,e)=>P(e),sx:{borderBottom:1,borderColor:"divider"},children:[(0,K.jsx)(f.A,{label:"All",value:"all"}),(0,K.jsx)(f.A,{label:"Unread",value:"unread"}),(0,K.jsx)(f.A,{label:"Read",value:"read"})]})}),(0,K.jsx)(A.A,{children:0===a.length?(0,K.jsxs)(c.A,{sx:{p:4,textAlign:"center"},children:[(0,K.jsx)(R.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,K.jsx)(l.A,{variant:"h6",color:"text.secondary",children:"No notifications"})]}):(0,K.jsx)(h.A,{children:a.map(e=>{return(0,K.jsxs)(p.Ay,{sx:{bgcolor:"unread"===e.status?"rgba(25, 118, 210, 0.05)":"transparent",borderBottom:"1px solid #e0e0e0",cursor:"pointer","&:hover":{bgcolor:"rgba(0, 0, 0, 0.04)"}},secondaryAction:(0,K.jsxs)(c.A,{children:["unread"===e.status&&(0,K.jsx)(v.A,{edge:"end",onClick:t=>{t.stopPropagation(),F(e.id)},children:(0,K.jsx)(C.A,{})}),(0,K.jsx)(v.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{try{await E.archiveNotification(t),_(e=>e.filter(e=>e.id!==t))}catch(e){G("Failed to archive notification")}})(e.id)},children:(0,K.jsx)(M.A,{})})]}),onClick:()=>(e=>{if("unread"===e.status&&F(e.id),e.entityType&&e.entityId){const a={deal:"/deals/".concat(e.entityId),property:"/properties/".concat(e.entityId),task:"/tasks/".concat(e.entityId),contact:"/contacts/".concat(e.entityId)}[e.entityType.toLowerCase()];a&&t(a)}})(e),children:[(0,K.jsx)(y.A,{children:(0,K.jsx)(g.A,{sx:{bgcolor:(n=e.priority,({urgent:"error",high:"warning",medium:"info",low:"default"}[n]||"default")+".main")},children:(a=e.type,{DEAL_STAGE_CHANGED:(0,K.jsx)(S.A,{}),TASK_DUE_SOON:(0,K.jsx)(j.A,{}),TASK_OVERDUE:(0,K.jsx)(j.A,{}),PROPERTY_STATUS_CHANGE:(0,K.jsx)(w.A,{}),CONTACT_ASSIGNED:(0,K.jsx)(D.A,{}),REPORT_READY:(0,K.jsx)(k.A,{}),SYSTEM_ALERT:(0,K.jsx)(R.A,{})}[a]||(0,K.jsx)(R.A,{}))})}),(0,K.jsx)(b.A,{primary:(0,K.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,K.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:"unread"===e.status?600:400},children:e.title}),(0,K.jsx)(d.A,{label:e.type.replace(/_/g," "),size:"small",sx:{height:20,fontSize:"0.7rem"}})]}),secondary:(0,K.jsxs)(c.A,{component:"span",children:[(0,K.jsx)(l.A,{component:"span",variant:"body2",color:"text.secondary",sx:{display:"block"},children:e.body}),(0,K.jsx)(l.A,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block"},children:z(new Date(e.createdAt),{addSuffix:!0})})]})})]},e.id);var a,n})})})]})}}}]);
//# sourceMappingURL=7734.e3535c11.chunk.js.map