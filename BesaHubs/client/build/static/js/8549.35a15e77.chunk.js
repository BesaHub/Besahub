"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[8549],{19252:(e,t,n)=>{n.d(t,{A:()=>f});var i=n(98587),a=n(58168),s=n(65043),r=n(58387),o=n(72372),c=n(98610),d=n(67598),l=n(52900),h=n(46060),x=n(18280),u=n(70579);const m=["className","component","disableGutters","fixed","maxWidth","classes"],p=(0,x.A)(),A=(0,h.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,d.A)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),v=e=>(0,l.A)({props:e,name:"MuiContainer",defaultTheme:p});var y=n(6803),b=n(34535),j=n(98206);const g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=A,useThemeProps:n=v,componentName:l="MuiContainer"}=e,h=t(e=>{let{theme:t,ownerState:n}=e;return(0,a.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})},e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce((e,n)=>{const i=n,a=t.breakpoints.values[i];return 0!==a&&(e[t.breakpoints.up(i)]={maxWidth:"".concat(a).concat(t.breakpoints.unit)}),e},{})},e=>{let{theme:t,ownerState:n}=e;return(0,a.A)({},"xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[n.maxWidth]).concat(t.breakpoints.unit)}})}),x=s.forwardRef(function(e,t){const s=n(e),{className:x,component:p="div",disableGutters:A=!1,fixed:v=!1,maxWidth:y="lg"}=s,b=(0,i.A)(s,m),j=(0,a.A)({},s,{component:p,disableGutters:A,fixed:v,maxWidth:y}),g=((e,t)=>{const{classes:n,fixed:i,disableGutters:a,maxWidth:s}=e,r={root:["root",s&&"maxWidth".concat((0,d.A)(String(s))),i&&"fixed",a&&"disableGutters"]};return(0,c.A)(r,e=>(0,o.Ay)(t,e),n)})(j,l);return(0,u.jsx)(h,(0,a.A)({as:p,ownerState:j,className:(0,r.A)(g.root,x),ref:t},b))});return x}({createStyledComponent:(0,b.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t["maxWidth".concat((0,y.A)(String(n.maxWidth)))],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,j.b)({props:e,name:"MuiContainer"})}),f=g},38549:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var i=n(65043),a=n(73216),s=n(19252),r=n(63336),o=n(96446),c=n(85865),d=n(76839),l=n(25078),h=n(12299),x=n(67254),u=n(81637),m=n(68903),p=n(12110),A=n(26494),v=n(67784),y=n(11906),b=n(39336),j=n(93234),g=n(66734),f=n(70579);const z=(0,g.A)((0,f.jsx)("path",{d:"M15 21h-2v-2h2zm-2-7h-2v5h2zm8-2h-2v4h2zm-2-2h-2v2h2zM7 12H5v2h2zm-2-2H3v2h2zm7-5h2V3h-2zm-7.5-.5v3h3v-3zM9 9H3V3h6zm-4.5 7.5v3h3v-3zM9 21H3v-6h6zm7.5-16.5v3h3v-3zM21 9h-6V3h6zm-2 10v-3h-4v2h2v3h4v-2zm-2-7h-4v2h4zm-4-2H7v2h2v2h2v-2h2zm1-1V7h-2V5h-2v4zM6.75 5.25h-1.5v1.5h1.5zm0 12h-1.5v1.5h1.5zm12-12h-1.5v1.5h1.5z"}),"QrCode2");var S=n(73835),C=n(98606),k=n(94505);const M=()=>{const e=(0,a.Zp)(),[t,n]=(0,i.useState)(0),[g,M]=(0,i.useState)(!1),[w,W]=(0,i.useState)(""),[R,F]=(0,i.useState)(null),[G,V]=(0,i.useState)(""),[B,E]=(0,i.useState)([]);(0,i.useEffect)(()=>{H()},[]);const H=async()=>{try{M(!0),W("");const e=await k.Ay.post("/mfa/setup");F(e.data),n(1)}catch(i){var e,t;console.error("MFA setup error:",i),W((null===(e=i.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to initialize MFA setup")}finally{M(!1)}};return(0,f.jsx)(s.A,{maxWidth:"md",sx:{py:4},children:(0,f.jsxs)(r.A,{elevation:3,sx:{p:4},children:[(0,f.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,f.jsx)(j.A,{sx:{fontSize:40,color:"primary.main",mr:2}}),(0,f.jsx)(c.A,{variant:"h4",children:"Set Up Multi-Factor Authentication"})]}),(0,f.jsx)(d.A,{activeStep:t,sx:{mb:4},children:["Generate Secret","Scan QR Code","Verify","Save Backup Codes"].map(e=>(0,f.jsx)(l.A,{children:(0,f.jsx)(h.A,{children:e})},e))}),w&&(0,f.jsx)(x.A,{severity:"error",sx:{mb:3},children:w}),0===t&&(0,f.jsxs)(o.A,{sx:{textAlign:"center",py:4},children:[(0,f.jsx)(u.A,{size:60}),(0,f.jsx)(c.A,{variant:"h6",sx:{mt:2},children:"Initializing MFA setup..."})]}),1===t&&R&&(0,f.jsxs)(o.A,{children:[(0,f.jsx)(x.A,{severity:"info",sx:{mb:3},children:(0,f.jsx)(c.A,{variant:"body2",children:"Scan the QR code with your authenticator app (Google Authenticator, Authy, etc.)"})}),(0,f.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,f.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,f.jsx)(p.A,{variant:"outlined",children:(0,f.jsxs)(A.A,{sx:{textAlign:"center"},children:[(0,f.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[(0,f.jsx)(z,{})," Scan QR Code"]}),(0,f.jsx)(o.A,{component:"img",src:R.qrCodeUrl,alt:"MFA QR Code",sx:{width:"100%",maxWidth:250,height:"auto",my:2}})]})})}),(0,f.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,f.jsx)(p.A,{variant:"outlined",children:(0,f.jsxs)(A.A,{children:[(0,f.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[(0,f.jsx)(S.A,{})," Manual Entry"]}),(0,f.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Can't scan? Enter this key manually:"}),(0,f.jsx)(v.A,{fullWidth:!0,value:R.manualEntryKey,InputProps:{readOnly:!0,sx:{fontFamily:"monospace",fontSize:"0.9rem"}},sx:{my:2}}),(0,f.jsx)(y.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(R.manualEntryKey),alert("Key copied to clipboard")},children:"Copy Key"})]})})})]}),(0,f.jsx)(o.A,{sx:{mt:4,textAlign:"center"},children:(0,f.jsx)(y.A,{variant:"contained",size:"large",onClick:()=>n(2),children:"Next: Verify Code"})})]}),2===t&&(0,f.jsxs)(o.A,{children:[(0,f.jsx)(x.A,{severity:"info",sx:{mb:3},children:(0,f.jsx)(c.A,{variant:"body2",children:"Enter the 6-digit code from your authenticator app to verify the setup"})}),(0,f.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),6===G.length)try{M(!0),W("");const e=await k.Ay.post("/mfa/verify-setup",{token:G,secret:R.secret});E(e.data.backupCodes),n(3)}catch(a){var t,i;console.error("MFA verification error:",a),W((null===(t=a.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.error)||"Invalid verification code")}finally{M(!1)}else W("Please enter a 6-digit code")},children:(0,f.jsxs)(o.A,{sx:{textAlign:"center"},children:[(0,f.jsx)(v.A,{label:"Verification Code",value:G,onChange:e=>V(e.target.value.replace(/\D/g,"").slice(0,6)),inputProps:{maxLength:6,style:{textAlign:"center",fontSize:"2rem",letterSpacing:"0.5rem",fontFamily:"monospace"}},sx:{width:300,my:3},autoFocus:!0,required:!0}),(0,f.jsx)(o.A,{sx:{mt:3},children:(0,f.jsx)(y.A,{type:"submit",variant:"contained",size:"large",disabled:g||6!==G.length,children:g?(0,f.jsx)(u.A,{size:24}):"Verify & Enable MFA"})})]})})]}),3===t&&B.length>0&&(0,f.jsxs)(o.A,{children:[(0,f.jsxs)(x.A,{severity:"warning",sx:{mb:3},children:[(0,f.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:"Important: Save these backup codes in a secure location!"}),(0,f.jsx)(c.A,{variant:"body2",children:"Each code can only be used once. You'll need them if you lose access to your authenticator app."})]}),(0,f.jsx)(p.A,{variant:"outlined",sx:{mb:3,bgcolor:"grey.50"},children:(0,f.jsxs)(A.A,{children:[(0,f.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Your Backup Codes"}),(0,f.jsx)(m.Ay,{container:!0,spacing:2,children:B.map((e,t)=>(0,f.jsx)(m.Ay,{item:!0,xs:6,children:(0,f.jsx)(r.A,{sx:{p:2,textAlign:"center",fontFamily:"monospace",bgcolor:"white"},children:e})},t))})]})}),(0,f.jsxs)(o.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,f.jsx)(y.A,{variant:"outlined",onClick:()=>{const e="BesaHubs CRM - MFA Backup Codes\n\n".concat(B.join("\n"),"\n\nSave these codes in a secure location. Each code can only be used once."),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="besahubs-mfa-backup-codes.txt",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},fullWidth:!0,children:"Download Codes"}),(0,f.jsx)(y.A,{variant:"outlined",onClick:()=>{const e=B.join("\n");navigator.clipboard.writeText(e),alert("Backup codes copied to clipboard")},fullWidth:!0,children:"Copy to Clipboard"})]}),(0,f.jsx)(b.A,{sx:{my:3}}),(0,f.jsxs)(o.A,{sx:{textAlign:"center"},children:[(0,f.jsx)(C.A,{sx:{fontSize:60,color:"success.main",mb:2}}),(0,f.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"MFA Successfully Enabled!"}),(0,f.jsx)(c.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Your account is now protected with two-factor authentication"}),(0,f.jsx)(y.A,{variant:"contained",size:"large",onClick:()=>{e("/settings")},children:"Go to Settings"})]})]})]})})}},73835:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(66734),a=n(70579);const s=(0,i.A)((0,a.jsx)("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"VpnKey")},93234:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(66734),a=n(70579);const s=(0,i.A)((0,a.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security")}}]);
//# sourceMappingURL=8549.35a15e77.chunk.js.map