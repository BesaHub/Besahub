"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[9489],{7183:(e,t,s)=>{s.d(t,{H4:()=>p,M:()=>l,Me:()=>x,jw:()=>n,mF:()=>d,xQ:()=>A});var r=s(89379),i=s(5766),a=s.n(i);const n={name:["name","property_name","title","property_title"],address:["address","street_address","street","location"],city:["city"],state:["state","region"],zipCode:["zip_code","zipcode","zip","postal_code"],propertyType:["property_type","type","category"],status:["status"],listingType:["listing_type","listing","sale_type"],listPrice:["list_price","price","asking_price","sale_price"],leaseRate:["lease_rate","rent","rental_rate","lease_price"],totalSquareFootage:["total_square_footage","sqft","square_feet","total_sqft","size"],buildingClass:["building_class","class","grade"],yearBuilt:["year_built","built_year","construction_year"],description:["description","notes","details"],zoning:["zoning"],parkingSpaces:["parking_spaces","parking","parking_spots"],marketingStatus:["marketing_status","listing_status"],pricePerSquareFoot:["price_per_square_foot","price_per_sqft","psf"]},l={firstName:["first_name","firstname","fname","given_name"],lastName:["last_name","lastname","lname","surname","family_name"],email:["email","email_address","e_mail"],phone:["phone","phone_number","mobile","telephone","cell"],company:["company","organization","business","employer"],title:["title","job_title","position","role"],type:["type","contact_type","category"],source:["source","lead_source","origin"],address:["address","street_address","street"],city:["city"],state:["state","region"],zipCode:["zip_code","zipcode","zip","postal_code"],country:["country"],website:["website","web","url","homepage"],notes:["notes","description","comments","remarks"]},o={propertyType:["office","retail","industrial","warehouse","multifamily","hotel","mixed_use","land","other"],status:["available","under_contract","sold","leased","off_market"],listingType:["sale","lease"],buildingClass:["A","B","C"],marketingStatus:["draft","published","archived"]},c={type:["lead","prospect","client","investor","vendor","broker"],source:["website","referral","cold_call","email","social_media","event","advertisement","other"]},d=e=>new Promise((t,s)=>{a().parse(e,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim().toLowerCase().replace(/\s+/g,"_"),transform:e=>e.trim(),complete:e=>{e.errors.length>0?s(new Error("CSV parsing errors: ".concat(e.errors.map(e=>e.message).join(", ")))):t({data:e.data,headers:e.meta.fields,totalRows:e.data.length})},error:e=>{s(e)}})}),p=(e,t)=>{const s={},r=[];return e.forEach(e=>{let i=!1;for(const[r,a]of Object.entries(t))if(a.includes(e)){s[e]=r,i=!0;break}i||r.push(e)}),{mapping:s,unmappedHeaders:r}},u=(e,t,s)=>{const r={},i=[],a=[];for(const[n,l]of Object.entries(e))if(t[n]&&l){r[t[n]]=l}return"property"===s?h(r,i,a):"contact"===s&&m(r,i,a),{data:r,errors:i,warnings:a,isValid:0===i.length}},h=(e,t,s)=>{e.name||e.address||t.push("Property must have either a name or address"),e.propertyType&&!o.propertyType.includes(e.propertyType)&&(s.push("Invalid property type: ".concat(e.propertyType,". Will default to 'other'")),e.propertyType="other"),e.status&&!o.status.includes(e.status)&&(s.push("Invalid status: ".concat(e.status,". Will default to 'available'")),e.status="available"),e.listingType&&!o.listingType.includes(e.listingType)&&(s.push("Invalid listing type: ".concat(e.listingType,". Will default to 'sale'")),e.listingType="sale"),e.buildingClass&&!o.buildingClass.includes(e.buildingClass)&&(s.push("Invalid building class: ".concat(e.buildingClass,". Will be cleared")),delete e.buildingClass),e.marketingStatus&&!o.marketingStatus.includes(e.marketingStatus)&&(s.push("Invalid marketing status: ".concat(e.marketingStatus,". Will default to 'draft'")),e.marketingStatus="draft");["listPrice","leaseRate","totalSquareFootage","yearBuilt","parkingSpaces","pricePerSquareFoot"].forEach(t=>{if(e[t]){const r=parseFloat(e[t].replace(/[$,]/g,""));isNaN(r)?(s.push("Invalid numeric value for ".concat(t,": ").concat(e[t],". Will be cleared")),delete e[t]):e[t]="yearBuilt"===t||"parkingSpaces"===t||"totalSquareFootage"===t?parseInt(r):r}}),e.yearBuilt&&(e.yearBuilt<1800||e.yearBuilt>(new Date).getFullYear()+5)&&s.push("Unusual year built: ".concat(e.yearBuilt)),e.propertyType||(e.propertyType="other"),e.status||(e.status="available"),e.listingType||(e.listingType="sale"),e.marketingStatus||(e.marketingStatus="draft")},m=(e,t,s)=>{e.firstName||e.lastName||e.email||t.push("Contact must have at least a first name, last name, or email"),e.email&&!/\S+@\S+\.\S+/.test(e.email)&&t.push("Invalid email format: ".concat(e.email)),e.type&&!c.type.includes(e.type)&&(s.push("Invalid contact type: ".concat(e.type,". Will default to 'lead'")),e.type="lead"),e.source&&!c.source.includes(e.source)&&(s.push("Invalid source: ".concat(e.source,". Will default to 'other'")),e.source="other"),e.phone&&(e.phone=e.phone.replace(/\D/g,""),e.phone.length<10&&s.push("Phone number seems too short: ".concat(e.phone))),e.website&&!e.website.startsWith("http")&&(e.website="https://"+e.website,s.push("Added https:// to website URL: ".concat(e.website))),e.type||(e.type="lead"),e.source||(e.source="other"),e.country||(e.country="US")},x=(e,t,s)=>{const i=[],a=[],n=[];return e.forEach((e,l)=>{const o=u(e,t,s);o.isValid?i.push((0,r.A)((0,r.A)({},o.data),{},{_originalRow:l+1,_warnings:o.warnings})):a.push((0,r.A)((0,r.A)({},e),{},{_originalRow:l+1,_errors:o.errors,_warnings:o.warnings})),n.push(...o.warnings)}),{validRows:i,invalidRows:a,totalRows:e.length,validCount:i.length,invalidCount:a.length,warnings:n}},y=e=>{let t,s;"property"===e?(t=["name","address","city","state","zip_code","property_type","status","listing_type","list_price","lease_rate","total_square_footage","building_class","year_built","description","zoning","parking_spaces","marketing_status","price_per_square_foot"],s=["Downtown Office Building","123 Main St","New York","NY","10001","office","available","sale","2500000","","15000","A","2020","Modern office space with city views","Commercial","50","published","167"]):(t=["first_name","last_name","email","phone","company","title","type","source","address","city","state","zip_code","country","website","notes"],s=["John","Smith","john.smith@email.com","555-123-4567","ABC Corp","CEO","client","referral","456 Business Ave","New York","NY","10002","US","https://abccorp.com","VIP client interested in office space"]);return[t.join(","),s.join(",")].join("\n")},A=(e,t)=>{const s=y(e),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const s=URL.createObjectURL(r);i.setAttribute("href",s),i.setAttribute("download",t||"".concat(e,"_import_template.csv")),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}}},89489:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Q});var r=s(89379),i=s(65043),a=s(73216),n=s(12110),l=s(26494),o=s(96446),c=s(85865),d=s(39336),p=s(11906),u=s(79650),h=s(71806),m=s(84882),x=s(28076),y=s(10039),A=s(73460),g=s(43845),j=s(53193),v=s(18356),b=s(72221),f=s(32143),w=s(67254),_=s(30279),C=s(35721),S=s(24628),k=s(2050),R=s(48734),I=s(10611),B=s(63336),T=s(76839),P=s(25078),V=s(12299),z=s(73158),D=s(87332),F=s(98606),M=s(43374),U=s(47968),W=s(17548),q=s(73794),N=s(44973),E=s(34642),O=s(8789),H=s(7183),L=s(94505),Y=s(70579);const Q=()=>{const e=(0,a.Zp)(),[t,s]=(0,i.useState)(0),[Q,Z]=(0,i.useState)(null),[$,J]=(0,i.useState)(null),[K,G]=(0,i.useState)({}),[X,ee]=(0,i.useState)([]),[te,se]=(0,i.useState)(null),[re,ie]=(0,i.useState)(!1),[ae,ne]=(0,i.useState)(0),[le,oe]=(0,i.useState)(null),[ce,de]=(0,i.useState)({open:!1,message:"",severity:"info"}),[pe,ue]=(0,i.useState)({valid:!1,invalid:!1,warnings:!1}),{getRootProps:he,getInputProps:me,isDragActive:xe}=(0,O.VB)({onDrop:async e=>{const t=e[0];if(t)if("text/csv"===t.type||t.name.endsWith(".csv"))try{Z(t);const e=await(0,H.mF)(t);J(e);const{mapping:r,unmappedHeaders:i}=(0,H.H4)(e.headers,H.jw);G(r),ee(i),s(1),de({open:!0,message:"Successfully loaded ".concat(e.totalRows," rows from CSV"),severity:"success"})}catch(r){de({open:!0,message:"Error parsing CSV: ".concat(r.message),severity:"error"})}else de({open:!0,message:"Please upload a CSV file",severity:"error"})},accept:{"text/csv":[".csv"]},multiple:!1,maxSize:10485760}),ye=()=>{const e=(0,H.Me)($.data,K,"property");se(e),s(2)},Ae=()=>{s(3)},ge=async()=>{ie(!0),ne(0);try{const{validRows:r}=te,i=r.length;let a=0,n=0;const l=[];for(let o=0;o<r.length;o++){try{await L.Kp.properties.create(r[o]),a++}catch(s){var e,t;n++,l.push({row:r[o]._originalRow,error:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message})}ne((o+1)/i*100)}oe({total:i,success:a,errors:n,errorDetails:l}),de({open:!0,message:"Import completed: ".concat(a," success, ").concat(n," errors"),severity:a>0?"success":"error"})}catch(s){de({open:!0,message:"Import failed: ".concat(s.message),severity:"error"})}finally{ie(!1)}},je=()=>{s(0),Z(null),J(null),G({}),ee([]),se(null),oe(null),ne(0)};return(0,Y.jsxs)(o.A,{children:[(0,Y.jsxs)(o.A,{sx:{mb:3},children:[(0,Y.jsx)(p.A,{startIcon:(0,Y.jsx)(D.A,{}),onClick:()=>{e("/properties")},sx:{mb:2},children:"Back to Properties"}),(0,Y.jsx)(c.A,{variant:"h4",sx:{fontWeight:700},children:"Import Properties from CSV"}),(0,Y.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Bulk import property data from a CSV file"})]}),(0,Y.jsx)(B.A,{sx:{p:3,mb:3},children:(0,Y.jsx)(T.A,{activeStep:t,children:["Upload CSV File","Map Columns","Review Data","Import Properties"].map(e=>(0,Y.jsx)(P.A,{children:(0,Y.jsx)(V.A,{children:e})},e))})}),(0,Y.jsxs)(o.A,{children:[0===t&&(0,Y.jsx)(n.A,{children:(0,Y.jsx)(l.A,{children:(0,Y.jsxs)(o.A,{sx:{textAlign:"center",py:4},children:[(0,Y.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Upload Property CSV File"}),(0,Y.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Upload a CSV file containing property data to import into your system"}),(0,Y.jsxs)(o.A,(0,r.A)((0,r.A)({},he()),{},{sx:{border:"2px dashed",borderColor:xe?"primary.main":"grey.300",borderRadius:2,p:4,cursor:"pointer",mb:3,backgroundColor:xe?"primary.light":"background.paper","&:hover":{backgroundColor:"grey.50"}},children:[(0,Y.jsx)("input",(0,r.A)({},me())),(0,Y.jsx)(M.A,{sx:{fontSize:48,color:"grey.500",mb:2}}),(0,Y.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:xe?"Drop CSV file here":"Upload CSV File"}),(0,Y.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Drag & drop your CSV file here, or click to browse",(0,Y.jsx)("br",{}),"Maximum file size: 10MB"]})]})),(0,Y.jsx)(d.A,{sx:{my:3},children:"OR"}),(0,Y.jsx)(p.A,{variant:"outlined",startIcon:(0,Y.jsx)(U.A,{}),onClick:()=>(0,H.xQ)("property"),sx:{mr:2},children:"Download Template"}),(0,Y.jsx)(p.A,{variant:"text",startIcon:(0,Y.jsx)(q.A,{}),onClick:()=>de({open:!0,message:"Template includes all supported fields with sample data",severity:"info"}),children:"Template Info"})]})})}),1===t&&(0,Y.jsx)(n.A,{children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Map CSV Columns to Database Fields"}),(0,Y.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Map your CSV columns to the appropriate property fields. Auto-mapped fields are shown below."}),(0,Y.jsx)(u.A,{children:(0,Y.jsxs)(h.A,{children:[(0,Y.jsx)(m.A,{children:(0,Y.jsxs)(x.A,{children:[(0,Y.jsx)(y.A,{children:"CSV Column"}),(0,Y.jsx)(y.A,{children:"Maps to Property Field"}),(0,Y.jsx)(y.A,{children:"Sample Data"})]})}),(0,Y.jsx)(A.A,{children:null===$||void 0===$?void 0:$.headers.map(e=>{var t;return(0,Y.jsxs)(x.A,{children:[(0,Y.jsx)(y.A,{children:(0,Y.jsx)(g.A,{label:e,color:K[e]?"primary":"default",variant:"outlined"})}),(0,Y.jsx)(y.A,{children:(0,Y.jsxs)(j.A,{size:"small",sx:{minWidth:200},children:[(0,Y.jsx)(v.A,{children:"Select Field"}),(0,Y.jsxs)(b.A,{value:K[e]||"",label:"Select Field",onChange:t=>{return s=e,i=t.target.value,void G(e=>(0,r.A)((0,r.A)({},e),{},{[s]:i}));var s,i},children:[(0,Y.jsx)(f.A,{value:"",children:(0,Y.jsx)("em",{children:"Don't import"})}),Object.keys(H.jw).map(e=>(0,Y.jsx)(f.A,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace(/([A-Z])/g," $1")},e))]})]})}),(0,Y.jsx)(y.A,{children:(0,Y.jsx)(c.A,{variant:"body2",color:"text.secondary",children:(null===$||void 0===$||null===(t=$.data[0])||void 0===t?void 0:t[e])||"N/A"})})]},e)})})]})}),X.length>0&&(0,Y.jsxs)(w.A,{severity:"warning",sx:{mt:2},children:["Unmapped columns: ",X.join(", ")]}),(0,Y.jsx)(o.A,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(p.A,{variant:"contained",onClick:ye,disabled:0===Object.keys(K).length,children:"Review Data"})})]})}),2===t&&(()=>{var e;return(0,Y.jsxs)(o.A,{children:[(0,Y.jsx)(n.A,{sx:{mb:2},children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Data Review Summary"}),(0,Y.jsxs)(o.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,Y.jsx)(g.A,{icon:(0,Y.jsx)(F.A,{}),label:"".concat((null===te||void 0===te?void 0:te.validCount)||0," Valid Rows"),color:"success",onClick:()=>ue(e=>(0,r.A)((0,r.A)({},e),{},{valid:!e.valid})),clickable:!0}),(0,Y.jsx)(g.A,{icon:(0,Y.jsx)(W.A,{}),label:"".concat((null===te||void 0===te?void 0:te.invalidCount)||0," Invalid Rows"),color:"error",onClick:()=>ue(e=>(0,r.A)((0,r.A)({},e),{},{invalid:!e.invalid})),clickable:!0}),(0,Y.jsx)(g.A,{icon:(0,Y.jsx)(E.A,{}),label:"".concat((null===te||void 0===te||null===(e=te.warnings)||void 0===e?void 0:e.length)||0," Warnings"),color:"warning",onClick:()=>ue(e=>(0,r.A)((0,r.A)({},e),{},{warnings:!e.warnings})),clickable:!0})]}),(null===te||void 0===te?void 0:te.invalidCount)>0&&(0,Y.jsxs)(w.A,{severity:"error",sx:{mb:2},children:[te.invalidCount," rows have errors and will be skipped during import."]})]})}),(0,Y.jsx)(_.A,{in:pe.valid,children:(0,Y.jsx)(n.A,{sx:{mb:2},children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Valid Rows (First 5)"}),(0,Y.jsx)(u.A,{sx:{maxHeight:300},children:(0,Y.jsxs)(h.A,{size:"small",children:[(0,Y.jsx)(m.A,{children:(0,Y.jsxs)(x.A,{children:[(0,Y.jsx)(y.A,{children:"Row"}),(0,Y.jsx)(y.A,{children:"Name/Address"}),(0,Y.jsx)(y.A,{children:"City, State"}),(0,Y.jsx)(y.A,{children:"Type"}),(0,Y.jsx)(y.A,{children:"Price"})]})}),(0,Y.jsx)(A.A,{children:null===te||void 0===te?void 0:te.validRows.slice(0,5).map((e,t)=>(0,Y.jsxs)(x.A,{children:[(0,Y.jsx)(y.A,{children:e._originalRow}),(0,Y.jsx)(y.A,{children:e.name||e.address}),(0,Y.jsxs)(y.A,{children:[e.city,", ",e.state]}),(0,Y.jsx)(y.A,{children:e.propertyType}),(0,Y.jsx)(y.A,{children:e.listPrice||e.leaseRate||"N/A"})]},t))})]})})]})})}),(0,Y.jsx)(_.A,{in:pe.invalid,children:(0,Y.jsx)(n.A,{sx:{mb:2},children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Invalid Rows"}),(0,Y.jsx)(C.A,{dense:!0,children:null===te||void 0===te?void 0:te.invalidRows.map((e,t)=>{var s;return(0,Y.jsxs)(S.Ay,{children:[(0,Y.jsx)(k.A,{children:(0,Y.jsx)(W.A,{color:"error"})}),(0,Y.jsx)(R.A,{primary:"Row ".concat(e._originalRow),secondary:null===(s=e._errors)||void 0===s?void 0:s.join(", ")})]},t)})})]})})}),(0,Y.jsx)(_.A,{in:pe.warnings,children:(0,Y.jsx)(n.A,{sx:{mb:2},children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Warnings"}),(0,Y.jsx)(C.A,{dense:!0,children:null===te||void 0===te?void 0:te.warnings.map((e,t)=>(0,Y.jsxs)(S.Ay,{children:[(0,Y.jsx)(k.A,{children:(0,Y.jsx)(E.A,{color:"warning"})}),(0,Y.jsx)(R.A,{primary:e})]},t))})]})})}),(0,Y.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[(0,Y.jsx)(p.A,{variant:"outlined",onClick:()=>s(1),children:"Back to Mapping"}),(0,Y.jsxs)(p.A,{variant:"contained",onClick:Ae,disabled:0===(null===te||void 0===te?void 0:te.validCount),children:["Import ",null===te||void 0===te?void 0:te.validCount," Properties"]})]})]})})(),3===t&&(0,Y.jsx)(n.A,{children:(0,Y.jsxs)(l.A,{children:[(0,Y.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:re?"Importing Properties...":"Import Complete"}),re&&(0,Y.jsxs)(o.A,{sx:{mb:3},children:[(0,Y.jsx)(I.A,{variant:"determinate",value:ae}),(0,Y.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Progress: ",Math.round(ae),"%"]})]}),le&&(0,Y.jsxs)(o.A,{children:[(0,Y.jsxs)(w.A,{severity:le.errors>0?"warning":"success",sx:{mb:2},children:["Import completed: ",le.success," successful, ",le.errors," failed"]}),le.errorDetails.length>0&&(0,Y.jsxs)(o.A,{children:[(0,Y.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Import Errors:"}),(0,Y.jsx)(C.A,{dense:!0,children:le.errorDetails.map((e,t)=>(0,Y.jsxs)(S.Ay,{children:[(0,Y.jsx)(k.A,{children:(0,Y.jsx)(W.A,{color:"error"})}),(0,Y.jsx)(R.A,{primary:"Row ".concat(e.row),secondary:e.error})]},t))})]}),(0,Y.jsxs)(o.A,{sx:{mt:3,display:"flex",justifyContent:"center",gap:2},children:[(0,Y.jsx)(p.A,{variant:"contained",onClick:()=>e("/properties"),children:"View Properties"}),(0,Y.jsx)(p.A,{variant:"outlined",onClick:je,children:"Import More"})]})]}),!re&&!le&&(0,Y.jsx)(o.A,{sx:{textAlign:"center"},children:(0,Y.jsx)(p.A,{variant:"contained",onClick:ge,startIcon:(0,Y.jsx)(N.A,{}),size:"large",disabled:0===(null===te||void 0===te?void 0:te.validCount),children:"Start Import"})})]})})]}),(0,Y.jsx)(z.A,{open:ce.open,autoHideDuration:6e3,onClose:()=>de((0,r.A)((0,r.A)({},ce),{},{open:!1})),children:(0,Y.jsx)(w.A,{onClose:()=>de((0,r.A)((0,r.A)({},ce),{},{open:!1})),severity:ce.severity,sx:{width:"100%"},children:ce.message})})]})}}}]);
//# sourceMappingURL=9489.e283855e.chunk.js.map