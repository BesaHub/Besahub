"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[6846],{32242:(e,t,a)=>{a.d(t,{kt:()=>i});a(65043);var s=a(96446),r=a(81637),l=a(85865),n=a(70579);const i=e=>{let{message:t="Loading...",size:a=40,fullscreen:i=!1}=e;const o=(0,n.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[(0,n.jsx)(r.A,{size:a}),t&&(0,n.jsx)(l.A,{variant:"body2",color:"text.secondary",children:t})]});return i?(0,n.jsx)(s.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255, 255, 255, 0.9)",zIndex:9999},children:o}):(0,n.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,width:"100%"},children:o})}},59529:(e,t,a)=>{a.d(t,{A_:()=>o,MA:()=>r,Md:()=>c,WK:()=>u,ZW:()=>n,ct:()=>d,eW:()=>m,i:()=>v,jn:()=>h,mQ:()=>i,n6:()=>l,uv:()=>x});var s=a(94505);const r=async()=>(await s.Ay.get("/dashboards")).data,l=async e=>(await s.Ay.post("/dashboards",e)).data,n=async e=>(await s.Ay.get("/dashboards/".concat(e))).data,i=async(e,t)=>(await s.Ay.put("/dashboards/".concat(e),t)).data,o=async e=>(await s.Ay.delete("/dashboards/".concat(e))).data,d=async(e,t)=>(await s.Ay.post("/dashboards/".concat(e,"/share"),t)).data,c=async e=>(await s.Ay.post("/dashboards/".concat(e,"/default"))).data,h=async(e,t)=>(await s.Ay.post("/dashboards/".concat(e,"/widgets"),t)).data,u=async(e,t)=>(await s.Ay.put("/dashboards/widgets/".concat(e),t)).data,x=async e=>(await s.Ay.delete("/dashboards/widgets/".concat(e))).data,m=async e=>(await s.Ay.post("/dashboards/widgets/query",e)).data,v=async e=>(await s.Ay.post("/dashboards/widgets/".concat(e,"/refresh"))).data},71255:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Se});var s=a(65043),r=a(73216),l=a(399),n=a(96446),i=a(92314),o=a(55263),d=a(17392),c=a(67784),h=a(11906),u=a(67254),x=a(19252),m=a(85865),v=a(87332),p=a(70141),g=a(43817),j=a(56630),A=a(37141),y=a(59529),f=a(89379),b=a(81637),w=a(12110),C=a(79958),S=a(26494),k=a(47805),W=a(50108),D=a(82291),I=a(87734),_=a(52185),E=a(6026),F=a(86150),N=a(21327),B=a(38643),P=a(75748),T=a(90168),z=a(60163),q=a(4240),H=a(17869),K=a(75614),L=a(75393),R=a(88507),U=a(70579);const G=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],M=e=>{let{widget:t,onRefresh:a}=e;const[r,l]=(0,s.useState)(null),[i,o]=(0,s.useState)(!0),[c,h]=(0,s.useState)(null),[x,v]=(0,s.useState)(null);(0,s.useEffect)(()=>{p()},[t]),(0,s.useEffect)(()=>{if(t.refreshInterval&&t.refreshInterval>0){const e=setInterval(()=>{p(!0)},1e3*t.refreshInterval);return()=>clearInterval(e)}},[t.refreshInterval]);const p=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{o(!0),h(null);const a=e?await(0,y.i)(t.id):await(0,y.eW)({dataset:t.dataset,query:t.query});a.success&&(l(a.data),v(new Date))}catch(r){var a,s;console.error("Error loading widget data:",r),h((null===(a=r.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load widget data")}finally{o(!1)}};return(0,U.jsxs)(w.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,U.jsx)(C.A,{title:t.title,action:(0,U.jsxs)(n.A,{display:"flex",alignItems:"center",gap:1,children:[x&&(0,U.jsx)(m.A,{variant:"caption",color:"text.secondary",children:x.toLocaleTimeString()}),(0,U.jsx)(d.A,{onClick:()=>{p(!0),a&&a()},size:"small",children:(0,U.jsx)(k.A,{})})]}),titleTypographyProps:{variant:"h6"}}),(0,U.jsx)(S.A,{sx:{flex:1,overflow:"auto"},children:(()=>{if(i)return(0,U.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",height:200,children:(0,U.jsx)(b.A,{})});if(c)return(0,U.jsx)(u.A,{severity:"error",children:c});switch(t.type){case"kpi":return(()=>{if(!r||!r.summary||!r.summary.metrics)return(0,U.jsx)(m.A,{children:"No data available"});const e=r.summary.metrics,t=Object.keys(e)[0],a=e[t];return(0,U.jsxs)(n.A,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:2,children:[(0,U.jsx)(m.A,{variant:"h2",fontWeight:"bold",color:"primary",children:"number"===typeof a?a.toLocaleString():a}),(0,U.jsx)(m.A,{variant:"body2",color:"text.secondary",textTransform:"capitalize",children:t.replace(/_/g," ")})]})})();case"bar":return(()=>{var e;if(!r||!r.chartData||0===r.chartData.length)return(0,U.jsx)(m.A,{children:"No data available"});const t=r.chartData,a=r.fields||[],s=(null===(e=a[0])||void 0===e?void 0:e.name)||"name",l=a.slice(1).map(e=>e.name);return(0,U.jsx)(W.u,{width:"100%",height:300,children:(0,U.jsxs)(D.E,{data:t,children:[(0,U.jsx)(I.d,{strokeDasharray:"3 3"}),(0,U.jsx)(_.W,{dataKey:s}),(0,U.jsx)(E.h,{}),(0,U.jsx)(F.m,{}),(0,U.jsx)(N.s,{}),l.map((e,t)=>(0,U.jsx)(B.y,{dataKey:e,fill:G[t%G.length]},e))]})})})();case"line":return(()=>{var e;if(!r||!r.chartData||0===r.chartData.length)return(0,U.jsx)(m.A,{children:"No data available"});const t=r.chartData,a=r.fields||[],s=(null===(e=a[0])||void 0===e?void 0:e.name)||"name",l=a.slice(1).map(e=>e.name);return(0,U.jsx)(W.u,{width:"100%",height:300,children:(0,U.jsxs)(P.b,{data:t,children:[(0,U.jsx)(I.d,{strokeDasharray:"3 3"}),(0,U.jsx)(_.W,{dataKey:s}),(0,U.jsx)(E.h,{}),(0,U.jsx)(F.m,{}),(0,U.jsx)(N.s,{}),l.map((e,t)=>(0,U.jsx)(T.N,{type:"monotone",dataKey:e,stroke:G[t%G.length],strokeWidth:2},e))]})})})();case"pie":return(()=>{var e,t;if(!r||!r.chartData||0===r.chartData.length)return(0,U.jsx)(m.A,{children:"No data available"});const a=r.chartData,s=r.fields||[],l=(null===(e=s[0])||void 0===e?void 0:e.name)||"name",n=(null===(t=s[1])||void 0===t?void 0:t.name)||"value",i=a.map(e=>({name:e[l],value:Number(e[n])||0}));return(0,U.jsx)(W.u,{width:"100%",height:300,children:(0,U.jsxs)(z.r,{children:[(0,U.jsx)(q.F,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:a}=e;return"".concat(t,": ").concat((100*a).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:i.map((e,t)=>(0,U.jsx)(H.f,{fill:G[t%G.length]},"cell-".concat(t)))}),(0,U.jsx)(F.m,{}),(0,U.jsx)(N.s,{})]})})})();case"table":return(()=>{if(!r||!r.rows||0===r.rows.length)return(0,U.jsx)(m.A,{children:"No data available"});const e=r.fields.map(e=>({field:e.name,headerName:e.name.replace(/_/g," ").toUpperCase(),flex:1,minWidth:100})),t=r.rows.map((e,t)=>(0,f.A)({id:t},e));return(0,U.jsx)(n.A,{height:400,children:(0,U.jsx)(R.zh,{rows:t,columns:e,pageSize:10,rowsPerPageOptions:[10,25,50],disableSelectionOnClick:!0,density:"compact"})})})();case"funnel":return(()=>{var e,t;if(!r||!r.chartData||0===r.chartData.length)return(0,U.jsx)(m.A,{children:"No data available"});const a=r.chartData,s=r.fields||[],l=(null===(e=s[0])||void 0===e?void 0:e.name)||"name",n=(null===(t=s[1])||void 0===t?void 0:t.name)||"value",i=a.map(e=>({name:e[l],value:Number(e[n])||0}));return(0,U.jsx)(W.u,{width:"100%",height:300,children:(0,U.jsxs)(K.v,{children:[(0,U.jsx)(F.m,{}),(0,U.jsx)(L.r,{dataKey:"value",data:i,isAnimationActive:!0,children:i.map((e,t)=>(0,U.jsx)(H.f,{fill:G[t%G.length]},"cell-".concat(t)))})]})})})();default:return(0,U.jsxs)(m.A,{children:["Unknown widget type: ",t.type]})}})()})]})};var O=a(53193),V=a(18356),Q=a(72221),Z=a(32143),Y=a(68903),J=a(83462),X=a(26600),$=a(35316),ee=a(76839),te=a(25078),ae=a(12299),se=a(29347);const re=[{value:"deals",label:"Deals"},{value:"tasks",label:"Tasks"},{value:"properties",label:"Properties"},{value:"contacts",label:"Contacts"},{value:"campaigns",label:"Campaigns"},{value:"agents",label:"Agents"}],le=[{value:"kpi",label:"KPI Card"},{value:"bar",label:"Bar Chart"},{value:"line",label:"Line Chart"},{value:"pie",label:"Pie Chart"},{value:"table",label:"Table"},{value:"funnel",label:"Funnel Chart"}],ne={deals:["count","sum","avg","win_rate","commission_total"],tasks:["count","completion_rate","avg_duration","overdue_count"],properties:["count","avg_price","total_value","avg_sqft"],contacts:["count","conversion_rate"],campaigns:["count","avg_open_rate","avg_click_rate","total_sent"],agents:["count","total_deals","total_commission","avg_win_rate"]},ie={deals:["stage","dealType","listingAgent","month","quarter"],tasks:["status","priority","taskType","assignedTo","month"],properties:["propertyType","status","city","state","listingAgent"],contacts:["contactRole","leadStatus","leadSource","assignedAgent"],campaigns:["type","status","month","createdBy"],agents:["role","department","month"]},oe=["Select Dataset","Choose Visualization","Configure Query","Preview & Name"],de=e=>{let{open:t,onClose:a,onAdd:r}=e;const[l,i]=(0,s.useState)(0),[o,d]=(0,s.useState)(""),[x,v]=(0,s.useState)(""),[p,g]=(0,s.useState)({metrics:[],groupBy:"",filters:{},limit:100}),[j,A]=(0,s.useState)(""),[b,C]=(0,s.useState)(null),[k,W]=(0,s.useState)(!1),[D,I]=(0,s.useState)(null),_=async()=>{try{W(!0),I(null);const e=await(0,y.eW)({dataset:o,query:p});e.success&&C(e.data)}catch(a){var e,t;console.error("Error previewing query:",a),I((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to preview query")}finally{W(!1)}},E=()=>{i(0),d(""),v(""),g({metrics:[],groupBy:"",filters:{},limit:100}),A(""),C(null),I(null),a()},F=()=>{switch(l){case 0:return""!==o;case 1:return""!==x;case 2:return p.metrics.length>0;case 3:return""!==j.trim();default:return!1}};return(0,U.jsxs)(J.A,{open:t,onClose:E,maxWidth:"md",fullWidth:!0,children:[(0,U.jsx)(X.A,{children:"Add Widget"}),(0,U.jsx)($.A,{children:(0,U.jsxs)(n.A,{sx:{width:"100%",mt:2},children:[(0,U.jsx)(ee.A,{activeStep:l,children:oe.map(e=>(0,U.jsx)(te.A,{children:(0,U.jsx)(ae.A,{children:e})},e))}),D&&(0,U.jsx)(u.A,{severity:"error",sx:{mt:2},onClose:()=>I(null),children:D}),(0,U.jsx)(n.A,{sx:{mt:3},children:(e=>{var t,a;switch(e){case 0:return(0,U.jsxs)(n.A,{sx:{minHeight:200},children:[(0,U.jsx)(m.A,{variant:"body1",gutterBottom:!0,children:"Select the data source for your widget"}),(0,U.jsxs)(O.A,{fullWidth:!0,sx:{mt:2},children:[(0,U.jsx)(V.A,{children:"Dataset"}),(0,U.jsx)(Q.A,{value:o,onChange:e=>d(e.target.value),label:"Dataset",children:re.map(e=>(0,U.jsx)(Z.A,{value:e.value,children:e.label},e.value))})]})]});case 1:return(0,U.jsxs)(n.A,{sx:{minHeight:200},children:[(0,U.jsx)(m.A,{variant:"body1",gutterBottom:!0,children:"Choose how you want to visualize the data"}),(0,U.jsx)(Y.Ay,{container:!0,spacing:2,sx:{mt:1},children:le.map(e=>(0,U.jsx)(Y.Ay,{item:!0,xs:6,sm:4,children:(0,U.jsx)(w.A,{sx:{cursor:"pointer",border:x===e.value?2:1,borderColor:x===e.value?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>v(e.value),children:(0,U.jsx)(S.A,{children:(0,U.jsx)(m.A,{variant:"h6",align:"center",children:e.label})})})},e.value))})]});case 2:return(0,U.jsxs)(n.A,{sx:{minHeight:200},children:[(0,U.jsx)(m.A,{variant:"body1",gutterBottom:!0,children:"Configure your query"}),(0,U.jsxs)(O.A,{fullWidth:!0,sx:{mt:2},children:[(0,U.jsx)(V.A,{children:"Metrics"}),(0,U.jsx)(Q.A,{multiple:!0,value:p.metrics,onChange:e=>g((0,f.A)((0,f.A)({},p),{},{metrics:e.target.value})),label:"Metrics",children:null===(t=ne[o])||void 0===t?void 0:t.map(e=>(0,U.jsx)(Z.A,{value:e,children:e.replace(/_/g," ").toUpperCase()},e))})]}),(0,U.jsxs)(O.A,{fullWidth:!0,sx:{mt:2},children:[(0,U.jsx)(V.A,{children:"Group By"}),(0,U.jsxs)(Q.A,{value:p.groupBy,onChange:e=>g((0,f.A)((0,f.A)({},p),{},{groupBy:e.target.value})),label:"Group By",children:[(0,U.jsx)(Z.A,{value:"",children:"None"}),null===(a=ie[o])||void 0===a?void 0:a.map(e=>(0,U.jsx)(Z.A,{value:e,children:e.replace(/_/g," ").toUpperCase()},e))]})]}),(0,U.jsx)(c.A,{fullWidth:!0,label:"Limit",type:"number",value:p.limit,onChange:e=>g((0,f.A)((0,f.A)({},p),{},{limit:parseInt(e.target.value)||100})),sx:{mt:2},InputProps:{inputProps:{min:1,max:1e3}}})]});case 3:return(0,U.jsxs)(n.A,{sx:{minHeight:200},children:[(0,U.jsx)(c.A,{fullWidth:!0,label:"Widget Title",value:j,onChange:e=>A(e.target.value),sx:{mb:2},placeholder:"Enter a descriptive title for your widget"}),k&&(0,U.jsx)(m.A,{children:"Loading preview..."}),b&&(0,U.jsxs)(n.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,U.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Preview"}),(0,U.jsx)(M,{widget:{id:"preview",type:x,dataset:o,query:p,title:j||"Preview"}})]})]});default:return null}})(l)})]})}),(0,U.jsxs)(se.A,{children:[(0,U.jsx)(h.A,{onClick:E,children:"Cancel"}),(0,U.jsx)(n.A,{sx:{flex:"1 1 auto"}}),l>0&&(0,U.jsx)(h.A,{onClick:()=>{i(e=>e-1)},children:"Back"}),l<oe.length-1?(0,U.jsx)(h.A,{variant:"contained",onClick:async()=>{2===l&&await _(),i(e=>e+1)},disabled:!F(),children:"Next"}):(0,U.jsx)(h.A,{variant:"contained",onClick:()=>{j.trim()?(r({type:x,dataset:o,query:p,title:j.trim(),position:{x:0,y:0,w:4,h:4},refreshInterval:null}),E()):I("Please enter a widget title")},disabled:!F(),children:"Add Widget"})]})]})};var ce=a(43845),he=a(35721),ue=a(24628),xe=a(48734),me=a(8266),ve=a(51387);const pe=["admin","manager","agent","assistant"],ge=e=>{let{open:t,onClose:a,dashboard:r}=e;const[l,i]=(0,s.useState)([]),[o,c]=(0,s.useState)([]),[x,v]=(0,s.useState)([]),[p,g]=(0,s.useState)(null),[j,A]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(r&&r.sharedWith){const e=r.sharedWith||[];v(e);const t=e.filter(e=>pe.includes(e)),a=e.filter(e=>!pe.includes(e));c(t),i(a)}},[r]);return(0,U.jsxs)(J.A,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,U.jsx)(X.A,{children:"Share Dashboard"}),(0,U.jsxs)($.A,{children:[p&&(0,U.jsx)(u.A,{severity:"error",sx:{mb:2},onClose:()=>g(null),children:p}),j&&(0,U.jsx)(u.A,{severity:"success",sx:{mb:2},children:j}),(0,U.jsxs)(n.A,{sx:{mb:3},children:[(0,U.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Share with roles"}),(0,U.jsxs)(O.A,{fullWidth:!0,sx:{mt:1},children:[(0,U.jsx)(V.A,{children:"Roles"}),(0,U.jsx)(Q.A,{multiple:!0,value:o,onChange:e=>c(e.target.value),label:"Roles",renderValue:e=>(0,U.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>(0,U.jsx)(ce.A,{label:e,size:"small"},e))}),children:pe.map(e=>(0,U.jsx)(Z.A,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),x.length>0&&(0,U.jsxs)(n.A,{children:[(0,U.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Current Shares"}),(0,U.jsx)(he.A,{dense:!0,children:x.map(e=>(0,U.jsxs)(ue.Ay,{children:[(0,U.jsx)(xe.A,{primary:pe.includes(e)?"Role: ".concat(e):"User ID: ".concat(e)}),(0,U.jsx)(me.A,{children:(0,U.jsx)(d.A,{edge:"end",onClick:()=>{return t=e,void(pe.includes(t)?c(o.filter(e=>e!==t)):i(l.filter(e=>e!==t)));var t},size:"small",children:(0,U.jsx)(ve.A,{})})})]},e))})]}),(0,U.jsx)(m.A,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Note: Users with shared access can view this dashboard but cannot edit it."})]}),(0,U.jsxs)(se.A,{children:[(0,U.jsx)(h.A,{onClick:a,children:"Cancel"}),(0,U.jsx)(h.A,{variant:"contained",onClick:async()=>{try{g(null);const e={userIds:l,roles:o};(await(0,y.ct)(r.id,e)).success&&(A("Dashboard shared successfully"),setTimeout(()=>{A(null),a()},2e3))}catch(s){var e,t;console.error("Error sharing dashboard:",s),g((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to share dashboard")}},children:"Save Changes"})]})]})};var je=a(69413),Ae=a(74605),ye=a(51962);const fe=[{value:"png",label:"PNG Image"},{value:"pdf",label:"PDF Document"},{value:"csv",label:"CSV (Table Widgets Only)"}],be=e=>{let{open:t,onClose:a,dashboard:r,widgets:l}=e;const[i,o]=(0,s.useState)("png"),[d,c]=(0,s.useState)([]),[x,v]=(0,s.useState)(null),[p,g]=(0,s.useState)(null);return(0,U.jsxs)(J.A,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0,children:[(0,U.jsx)(X.A,{children:"Export Dashboard"}),(0,U.jsxs)($.A,{children:[x&&(0,U.jsx)(u.A,{severity:"error",sx:{mb:2},onClose:()=>v(null),children:x}),p&&(0,U.jsx)(u.A,{severity:"info",sx:{mb:2},children:p}),(0,U.jsxs)(O.A,{fullWidth:!0,sx:{mb:3},children:[(0,U.jsx)(V.A,{children:"Export Format"}),(0,U.jsx)(Q.A,{value:i,onChange:e=>o(e.target.value),label:"Export Format",children:fe.map(e=>(0,U.jsx)(Z.A,{value:e.value,children:e.label},e.value))})]}),(0,U.jsxs)(n.A,{sx:{mb:2},children:[(0,U.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[(0,U.jsx)(m.A,{variant:"subtitle2",children:"Select Widgets to Export"}),(0,U.jsx)(h.A,{size:"small",onClick:()=>{d.length===l.length?c([]):c(l.map(e=>e.id))},children:d.length===l.length?"Deselect All":"Select All"})]}),(0,U.jsx)(je.A,{children:l.map(e=>(0,U.jsx)(Ae.A,{control:(0,U.jsx)(ye.A,{checked:d.includes(e.id),onChange:()=>{return t=e.id,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}}),label:"".concat(e.title," (").concat(e.type,")")},e.id))})]}),(0,U.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:["Note: Export functionality will generate a ",i.toUpperCase()," file with the selected widgets."]})]}),(0,U.jsxs)(se.A,{children:[(0,U.jsx)(h.A,{onClick:a,children:"Cancel"}),(0,U.jsx)(h.A,{variant:"contained",startIcon:(0,U.jsx)(j.A,{}),onClick:async()=>{try{if(v(null),0===d.length)return void v("Please select at least one widget to export");if("csv"===i){if(0===l.filter(e=>"table"===e.type&&d.includes(e.id)).length)return void v("CSV export is only available for table widgets")}g("Export feature is available in premium version"),setTimeout(()=>{g(null),a()},2e3)}catch(e){console.error("Error exporting dashboard:",e),v("Failed to export dashboard")}},children:"Export"})]})]})};var we=a(32242);a(65211);const Ce=(0,l.WidthProvider)(l.Responsive),Se=()=>{const{id:e}=(0,r.g)(),t=(0,r.Zp)(),a="new"===e,[l,f]=(0,s.useState)(!a),[b,w]=(0,s.useState)(null),[C,S]=(0,s.useState)(""),[k,W]=(0,s.useState)([]),[D,I]=(0,s.useState)([]),[_,E]=(0,s.useState)(null),[F,N]=(0,s.useState)(null),[B,P]=(0,s.useState)(!1),[T,z]=(0,s.useState)(!1),[q,H]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a||K()},[e]);const K=async()=>{try{f(!0),E(null);const a=await(0,y.ZW)(e);if(a.success){var t;w(a.data),S(a.data.name),W(a.data.widgets||[]);const e=(null===(t=a.data.widgets)||void 0===t?void 0:t.map(e=>({i:e.id,x:e.position.x||0,y:e.position.y||0,w:e.position.w||4,h:e.position.h||4,minW:2,minH:2})))||[];I(e)}}catch(r){var a,s;console.error("Error fetching dashboard:",r),E((null===(a=r.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load dashboard")}finally{f(!1)}};return l?(0,U.jsx)(we.kt,{}):(0,U.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[(0,U.jsx)(i.A,{position:"static",color:"default",elevation:1,children:(0,U.jsxs)(o.A,{children:[(0,U.jsx)(d.A,{edge:"start",onClick:()=>t("/dashboards"),sx:{mr:2},children:(0,U.jsx)(v.A,{})}),(0,U.jsx)(c.A,{value:C,onChange:e=>S(e.target.value),placeholder:"Dashboard Name",variant:"standard",sx:{minWidth:300,mr:2},InputProps:{sx:{fontSize:"1.25rem",fontWeight:500}}}),(0,U.jsx)(n.A,{sx:{flexGrow:1}}),(0,U.jsx)(h.A,{startIcon:(0,U.jsx)(p.A,{}),onClick:()=>P(!0),sx:{mr:1},disabled:a,children:"Add Widget"}),!a&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(h.A,{startIcon:(0,U.jsx)(g.A,{}),onClick:()=>z(!0),sx:{mr:1},children:"Share"}),(0,U.jsx)(h.A,{startIcon:(0,U.jsx)(j.A,{}),onClick:()=>H(!0),sx:{mr:1},children:"Export"})]}),(0,U.jsx)(h.A,{variant:"contained",startIcon:(0,U.jsx)(A.A,{}),onClick:async()=>{try{if(E(null),!C.trim())return void E("Dashboard name is required");if(a){const e=await(0,y.n6)({name:C,description:"",layout:{},isDefault:!1});e.success&&(N("Dashboard created successfully"),t("/dashboards/".concat(e.data.id)))}else{const t={};D.forEach(e=>{t[e.i]={x:e.x,y:e.y,w:e.w,h:e.h}}),await(0,y.mQ)(e,{name:C,layout:t});for(const e of k){const t=D.find(t=>t.i===e.id);t&&await(0,y.WK)(e.id,{position:{x:t.x,y:t.y,w:t.w,h:t.h}})}N("Dashboard saved successfully"),setTimeout(()=>N(null),3e3)}}catch(l){var s,r;console.error("Error saving dashboard:",l),E((null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to save dashboard")}},children:"Save"})]})}),_&&(0,U.jsx)(u.A,{severity:"error",onClose:()=>E(null),sx:{m:2},children:_}),F&&(0,U.jsx)(u.A,{severity:"success",onClose:()=>N(null),sx:{m:2},children:F}),(0,U.jsx)(x.A,{maxWidth:"xl",sx:{flex:1,py:3,overflow:"auto"},children:0===k.length?(0,U.jsxs)(n.A,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"60vh",children:[(0,U.jsx)(m.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:a?"Save your dashboard first":"No widgets yet"}),(0,U.jsx)(m.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:a?"Click Save to create the dashboard, then add widgets":'Click "Add Widget" to start building your dashboard'}),!a&&(0,U.jsx)(h.A,{variant:"contained",startIcon:(0,U.jsx)(p.A,{}),onClick:()=>P(!0),sx:{mt:2},children:"Add Your First Widget"})]}):(0,U.jsx)(Ce,{className:"layout",layouts:{lg:D},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,onLayoutChange:e=>{I(e)},draggableHandle:".drag-handle",children:k.map(e=>(0,U.jsx)("div",{children:(0,U.jsxs)(n.A,{sx:{height:"100%",position:"relative"},children:[(0,U.jsx)(n.A,{className:"drag-handle",sx:{position:"absolute",top:0,left:0,right:0,height:40,cursor:"move",zIndex:10,"&:hover":{bgcolor:"action.hover"}}}),(0,U.jsx)(M,{widget:e})]})},e.id))})}),(0,U.jsx)(de,{open:B,onClose:()=>P(!1),onAdd:async t=>{try{if(E(null),a)return void E("Please save the dashboard first before adding widgets");const s=await(0,y.jn)(e,t);if(s.success){const e=s.data;W([...k,e]),I([...D,{i:e.id,x:e.position.x||0,y:e.position.y||0,w:e.position.w||4,h:e.position.h||4,minW:2,minH:2}]),N("Widget added successfully"),setTimeout(()=>N(null),3e3)}}catch(l){var s,r;console.error("Error adding widget:",l),E((null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to add widget")}}}),b&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(ge,{open:T,onClose:()=>z(!1),dashboard:b}),(0,U.jsx)(be,{open:q,onClose:()=>H(!1),dashboard:b,widgets:k})]})]})}}}]);
//# sourceMappingURL=6846.74cb0c7f.chunk.js.map