"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[2961],{90151:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var a=n(89379),l=n(65043),o=n(19252),s=n(96446),i=n(85865),r=n(67784),c=n(51787),d=n(77739),u=n(17392),h=n(72437),v=n(32143),A=n(11906),x=n(81637),m=n(67254),g=n(43845),p=n(63336),w=n(79484),f=n(34190),j=n(71991),y=n(13479),C=n(70141),S=n(9554),b=n(86178),D=n.n(b),k=(n(83656),n(8411)),E=n(83462),F=n(26600),I=n(35316),W=n(53193),z=n(18356),L=n(72221),O=n(74605),G=n(19042),N=n(29347),M=n(51387),P=n(18802),T=n(58390),U=n(60779),_=n(70579);const q=e=>{let{open:t,event:n,accounts:o,onClose:i,onSave:c,onDelete:d}=e;const[h,g]=(0,l.useState)(""),[p,w]=(0,l.useState)(""),[f,y]=(0,l.useState)(""),[C,S]=(0,l.useState)(new Date),[b,D]=(0,l.useState)(new Date),[q,B]=(0,l.useState)(!1),[H,K]=(0,l.useState)(""),[V,R]=(0,l.useState)(""),[Z,$]=(0,l.useState)(!1),[J,Q]=(0,l.useState)(!1),[X,Y]=(0,l.useState)(null);(0,l.useEffect)(()=>{n?(g(n.title||""),w(n.description||""),y(n.location||""),S(n.start?new Date(n.start):new Date),D(n.end?new Date(n.end):new Date),B(n.isAllDay||!1),K(n.attendees?n.attendees.map(e=>e.email||e).join(", "):""),R(n.calendarAccountId||(o.length>0?o[0].id:""))):ee()},[n,o]);const ee=()=>{g(""),w(""),y(""),S(new Date),D(new Date),B(!1),K(""),R(o.length>0?o[0].id:""),Y(null)},te=()=>{ee(),i()},ne=o.filter(e=>e.isActive);return(0,_.jsxs)(E.A,{open:t,onClose:te,maxWidth:"sm",fullWidth:!0,children:[(0,_.jsx)(F.A,{children:n&&n.id?"Edit Event":"Create New Event"}),(0,_.jsx)(I.A,{children:(0,_.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[X&&(0,_.jsx)(m.A,{severity:"error",onClose:()=>Y(null),children:X}),0===ne.length&&(0,_.jsx)(m.A,{severity:"warning",children:"No active calendar accounts available. Please connect a calendar first."}),(0,_.jsxs)(W.A,{fullWidth:!0,children:[(0,_.jsx)(z.A,{children:"Calendar Account"}),(0,_.jsx)(L.A,{value:V,onChange:e=>R(e.target.value),label:"Calendar Account",disabled:n&&n.id,children:ne.map(e=>(0,_.jsx)(v.A,{value:e.id,children:(0,_.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:["google"===e.provider&&(0,_.jsx)(j.A,{sx:{fontSize:18}}),e.email]})},e.id))})]}),(0,_.jsx)(r.A,{label:"Title",value:h,onChange:e=>g(e.target.value),fullWidth:!0,required:!0,autoFocus:!0}),(0,_.jsx)(r.A,{label:"Description",value:p,onChange:e=>w(e.target.value),fullWidth:!0,multiline:!0,rows:3}),(0,_.jsx)(r.A,{label:"Location",value:f,onChange:e=>y(e.target.value),fullWidth:!0}),(0,_.jsx)(O.A,{control:(0,_.jsx)(G.A,{checked:q,onChange:e=>B(e.target.checked)}),label:"All-day event"}),(0,_.jsxs)(T.$,{dateAdapter:P.h,children:[(0,_.jsx)(U.K,{label:"Start",value:C,onChange:e=>S(e),renderInput:e=>(0,_.jsx)(r.A,(0,a.A)((0,a.A)({},e),{},{fullWidth:!0})),disabled:q}),(0,_.jsx)(U.K,{label:"End",value:b,onChange:e=>D(e),renderInput:e=>(0,_.jsx)(r.A,(0,a.A)((0,a.A)({},e),{},{fullWidth:!0})),disabled:q,minDateTime:C})]}),(0,_.jsx)(r.A,{label:"Attendees (comma-separated emails)",value:H,onChange:e=>K(e.target.value),fullWidth:!0,placeholder:"email1@example.com, email2@example.com",helperText:"Separate multiple email addresses with commas"})]})}),(0,_.jsxs)(N.A,{sx:{px:3,pb:2},children:[n&&n.id&&(0,_.jsx)(u.A,{onClick:async()=>{if(window.confirm("Are you sure you want to delete this event?"))try{Q(!0),Y(null),await k.A.deleteEvent(n.id),d(),ee()}catch(a){var e,t;console.error("Failed to delete event:",a),Y((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to delete event")}finally{Q(!1)}},disabled:J||Z,color:"error",sx:{mr:"auto"},children:J?(0,_.jsx)(x.A,{size:24}):(0,_.jsx)(M.A,{})}),(0,_.jsx)(A.A,{onClick:te,disabled:Z||J,children:"Cancel"}),(0,_.jsx)(A.A,{onClick:async()=>{try{if(!h.trim())return void Y("Event title is required");if(!V)return void Y("Please select a calendar account");$(!0),Y(null);const e={accountId:V,title:h.trim(),description:p.trim()||null,location:f.trim()||null,start:C.toISOString(),end:b.toISOString(),isAllDay:q,attendees:H?H.split(",").map(e=>e.trim()).filter(Boolean):[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};n&&n.id?await k.A.updateEvent(n.id,e):await k.A.createEvent(e),c(),ee()}catch(a){var e,t;console.error("Failed to save event:",a),Y((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to save event")}finally{$(!1)}},variant:"contained",disabled:Z||J||0===ne.length,children:Z?(0,_.jsx)(x.A,{size:24}):"Save"})]})]})},B=(0,S.ye)(D()),H=()=>{const[e,t]=(0,l.useState)("month"),[n,b]=(0,l.useState)(new Date),[E,F]=(0,l.useState)([]),[I,W]=(0,l.useState)([]),[z,L]=(0,l.useState)(!0),[O,G]=(0,l.useState)(!1),[N,M]=(0,l.useState)(null),[P,T]=(0,l.useState)(!1),[U,H]=(0,l.useState)(null),[K,V]=(0,l.useState)(null),[R,Z]=(0,l.useState)(null),[$,J]=(0,l.useState)(""),Q=(0,l.useCallback)(async()=>{try{const e=await k.A.getAccounts();W(e.data.accounts||[])}catch(e){console.error("Failed to fetch calendar accounts:",e)}},[]),X=(0,l.useCallback)(async()=>{try{L(!0),M(null);const e=D()(n).startOf("month").subtract(7,"days").toISOString(),t={from:e,to:D()(n).endOf("month").add(7,"days").toISOString(),limit:1e3};R&&(t.accountId=R);const l=((await k.A.getEvents(t)).data.events||[]).map(e=>{var t,n;return{id:e.id,title:e.title,start:new Date(e.start),end:new Date(e.end),allDay:e.isAllDay,resource:(0,a.A)((0,a.A)({},e),{},{provider:null===(t=e.calendarAccount)||void 0===t?void 0:t.provider,accountEmail:null===(n=e.calendarAccount)||void 0===n?void 0:n.email})}});F(l)}catch(e){console.error("Failed to fetch events:",e),M("Failed to load calendar events")}finally{L(!1)}},[n,R]);(0,l.useEffect)(()=>{Q()},[Q]),(0,l.useEffect)(()=>{(I.length>0||null===R)&&X()},[X,I]);const Y=E.filter(e=>!$||e.title.toLowerCase().includes($.toLowerCase()));return(0,_.jsxs)(o.A,{maxWidth:"xl",sx:{mt:2,mb:4},children:[(0,_.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,_.jsx)(i.A,{variant:"h4",sx:{fontWeight:600},children:"Calendar"}),(0,_.jsxs)(s.A,{sx:{display:"flex",gap:1},children:[(0,_.jsx)(r.A,{size:"small",placeholder:"Search events...",value:$,onChange:e=>J(e.target.value),InputProps:{startAdornment:(0,_.jsx)(c.A,{position:"start",children:(0,_.jsx)(w.A,{})})},sx:{width:250}}),(0,_.jsx)(d.A,{title:"Filter by account",children:(0,_.jsx)(u.A,{onClick:e=>V(e.currentTarget),color:R?"primary":"default",children:(0,_.jsx)(f.A,{})})}),(0,_.jsxs)(h.A,{anchorEl:K,open:Boolean(K),onClose:()=>V(null),children:[(0,_.jsx)(v.A,{onClick:()=>{Z(null),V(null)},children:"All Accounts"}),I.map(e=>(0,_.jsxs)(v.A,{onClick:()=>{Z(e.id),V(null)},children:["google"===e.provider&&(0,_.jsx)(j.A,{sx:{mr:1,fontSize:18}}),e.email]},e.id))]}),(0,_.jsx)(A.A,{variant:"outlined",startIcon:O?(0,_.jsx)(x.A,{size:16}):(0,_.jsx)(y.A,{}),onClick:async()=>{try{G(!0),M(null);for(const e of I)e.isActive&&await k.A.syncAccount(e.id);await Q(),await X()}catch(e){console.error("Failed to sync calendars:",e),M("Failed to sync calendars")}finally{G(!1)}},disabled:O||0===I.length,children:"Sync"}),(0,_.jsx)(A.A,{variant:"outlined",startIcon:(0,_.jsx)(j.A,{}),onClick:async()=>{try{const e=(await k.A.getConnectUrl("google")).data.authUrl,t=600,n=700,a=(window.screen.width-t)/2,l=(window.screen.height-n)/2,o=window.open(e,"Connect Google Calendar","width=".concat(t,",height=").concat(n,",left=").concat(a,",top=").concat(l)),s=e=>{"calendar-connected"===e.data.type?(o.close(),Q(),X(),window.removeEventListener("message",s)):"calendar-error"===e.data.type&&(o.close(),M(e.data.error||"Failed to connect calendar"),window.removeEventListener("message",s))};window.addEventListener("message",s)}catch(e){console.error("Failed to connect Google Calendar:",e),M("Failed to connect Google Calendar")}},children:"Connect Google"}),(0,_.jsx)(A.A,{variant:"outlined",onClick:async()=>{try{const e=(await k.A.getConnectUrl("microsoft")).data.authUrl,t=600,n=700,a=(window.screen.width-t)/2,l=(window.screen.height-n)/2,o=window.open(e,"Connect Microsoft Calendar","width=".concat(t,",height=").concat(n,",left=").concat(a,",top=").concat(l)),s=e=>{"calendar-connected"===e.data.type?(o.close(),Q(),X(),window.removeEventListener("message",s)):"calendar-error"===e.data.type&&(o.close(),M(e.data.error||"Failed to connect calendar"),window.removeEventListener("message",s))};window.addEventListener("message",s)}catch(e){console.error("Failed to connect Microsoft Calendar:",e),M("Failed to connect Microsoft Calendar")}},children:"Connect Microsoft"}),(0,_.jsx)(A.A,{variant:"contained",startIcon:(0,_.jsx)(C.A,{}),onClick:()=>{H({start:new Date,end:D()().add(1,"hour").toDate(),isAllDay:!1}),T(!0)},disabled:0===I.length,children:"New Event"})]})]}),N&&(0,_.jsx)(m.A,{severity:"error",sx:{mb:2},onClose:()=>M(null),children:N}),0===I.length&&!z&&(0,_.jsx)(m.A,{severity:"info",sx:{mb:2},children:"No calendar accounts connected. Please connect Google Calendar or Microsoft Outlook to get started."}),I.length>0&&(0,_.jsx)(s.A,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:I.map(e=>(0,_.jsx)(g.A,{icon:"google"===e.provider?(0,_.jsx)(j.A,{}):void 0,label:"".concat(e.email," ").concat(e.lastSyncedAt?"(synced ".concat(D()(e.lastSyncedAt).fromNow(),")"):"(not synced)"),color:e.isActive?"primary":"default",variant:e.isActive?"filled":"outlined",size:"small"},e.id))}),(0,_.jsx)(p.A,{sx:{p:2,minHeight:600},children:z?(0,_.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:600},children:(0,_.jsx)(x.A,{})}):(0,_.jsx)(S.Vv,{localizer:B,events:Y,startAccessor:"start",endAccessor:"end",style:{height:600},view:e,onView:t,date:n,onNavigate:b,onSelectEvent:e=>{H(e.resource),T(!0)},onSelectSlot:e=>{let{start:t,end:n}=e;H({start:t,end:n,isAllDay:!1}),T(!0)},selectable:!0,eventPropGetter:e=>{var t;const n=null===(t=e.resource)||void 0===t?void 0:t.provider;let a="#3174ad";return"google"===n?a="#4285f4":"microsoft"===n&&(a="#00a4ef"),{style:{backgroundColor:a,borderRadius:"4px",opacity:.9,color:"white",border:"0px",display:"block"}}},views:["month","week","day","agenda"]})}),(0,_.jsx)(q,{open:P,event:U,accounts:I,onClose:()=>{T(!1),H(null)},onSave:()=>{T(!1),H(null),X()},onDelete:()=>{T(!1),H(null),X()}})]})}}}]);
//# sourceMappingURL=2961.44aad075.chunk.js.map