"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[8216],{3632:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66734),o=r(70579);const s=(0,n.A)((0,o.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},16314:(e,t,r)=>{r.d(t,{A:()=>s,m:()=>o});var n=r(94505);const o={getDebts:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams(e).toString(),r="/debt".concat(t?"?".concat(t):"");return(await n.Ay.get(r)).data}catch(t){throw console.error("Error fetching debt records:",t),t}},getDebt:async e=>{try{return(await n.Ay.get("/debt/".concat(e))).data}catch(t){throw console.error("Error fetching debt record:",t),t}},createDebt:async e=>{try{return(await n.Ay.post("/debt",e)).data}catch(t){throw console.error("Error creating debt record:",t),t}},updateDebt:async(e,t)=>{try{return(await n.Ay.put("/debt/".concat(e),t)).data}catch(r){throw console.error("Error updating debt record:",r),r}},deleteDebt:async e=>{try{return(await n.Ay.delete("/debt/".concat(e))).data}catch(t){throw console.error("Error deleting debt record:",t),t}},getMaturingDebts:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:180;try{return(await n.Ay.get("/debt/maturing/soon?days=".concat(e))).data}catch(t){throw console.error("Error fetching maturing debts:",t),t}}},s=o},51387:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66734),o=r(70579);const s=(0,n.A)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},58216:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var n=r(89379),o=r(65043),s=r(12110),i=r(26494),a=r(96446),l=r(85865),c=r(81637),d=r(11906),h=r(67254),x=r(68903),u=r(63336),A=r(67784),m=r(51787),p=r(79650),y=r(71806),j=r(84882),g=r(28076),v=r(10039),b=r(73460),f=r(43845),S=r(17392),D=r(83462),w=r(26600),z=r(35316),C=r(29347),M=r(73158),R=r(70141),W=r(67957),T=r(84770),F=r(98606),L=r(51387),k=r(83560),I=r(47805),P=r(79484),E=r(3632),H=r(34642),N=r(73216),U=r(16314),V=r(70579);const B=()=>{var e,t;const r=(0,N.Zp)(),[B,_]=(0,o.useState)([]),[O,X]=(0,o.useState)(!0),[Z,q]=(0,o.useState)(null),[G,J]=(0,o.useState)(""),[K,Q]=(0,o.useState)(""),[Y,$]=(0,o.useState)({open:!1,debt:null}),[ee,te]=(0,o.useState)({open:!1,message:"",severity:"success"});(0,o.useEffect)(()=>{re()},[]);const re=async()=>{try{X(!0),q(null);const e=await U.m.getDebts();_(e.debts||[])}catch(e){console.error("Error fetching debts:",e),q("Failed to load debt records"),_([])}finally{X(!1)}},ne=e=>{const t=new Date,r=new Date(e)-t;return Math.floor(r/864e5)},oe=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),se=B.filter(e=>{var t,r;const n=!G||((null===(t=e.Property)||void 0===t?void 0:t.name)||"").toLowerCase().includes(G.toLowerCase())||((null===(r=e.Lender)||void 0===r?void 0:r.name)||"").toLowerCase().includes(G.toLowerCase()),o=!K||e.loanType===K;return n&&o}),ie={totalDebt:B.reduce((e,t)=>e+parseFloat(t.amount||0),0),totalRecords:B.length,maturingSoon:B.filter(e=>{const t=ne(e.maturityDate);return t>=0&&t<180}).length,matured:B.filter(e=>ne(e.maturityDate)<0).length,avgDSCR:B.length>0?(B.reduce((e,t)=>e+parseFloat(t.dscr||0),0)/B.length).toFixed(2):0},ae=e=>{let{title:t,value:r,subtitle:n,color:o="#1976d2",icon:c}=e;return(0,V.jsx)(s.A,{children:(0,V.jsxs)(i.A,{children:[(0,V.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[c&&(0,V.jsx)(c,{sx:{color:o,mr:1}}),(0,V.jsx)(l.A,{variant:"h4",sx:{fontWeight:700,color:o},children:r})]}),(0,V.jsx)(l.A,{variant:"body2",color:"textSecondary",sx:{fontWeight:500},children:t}),n&&(0,V.jsx)(l.A,{variant:"caption",color:"textSecondary",children:n})]})})};return O?(0,V.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,V.jsx)(c.A,{size:60})}):(0,V.jsxs)(a.A,{children:[(0,V.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,V.jsx)(l.A,{variant:"h4",sx:{fontWeight:700},children:"Debt Management"}),(0,V.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,V.jsx)(d.A,{variant:"outlined",startIcon:(0,V.jsx)(I.A,{}),onClick:re,disabled:O,children:"Refresh"}),(0,V.jsx)(d.A,{variant:"contained",startIcon:(0,V.jsx)(R.A,{}),children:"Add Debt"})]})]}),Z&&(0,V.jsx)(h.A,{severity:"error",sx:{mb:3},onClose:()=>q(null),children:Z}),(0,V.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,V.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,V.jsx)(ae,{title:"Total Debt",value:oe(ie.totalDebt),subtitle:"All properties",color:"#1976d2",icon:W.A})}),(0,V.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,V.jsx)(ae,{title:"Total Records",value:ie.totalRecords,subtitle:"Debt instruments",color:"#2e7d32",icon:T.A})}),(0,V.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,V.jsx)(ae,{title:"Maturing Soon",value:ie.maturingSoon,subtitle:"Within 6 months",color:"#f57c00",icon:H.A})}),(0,V.jsx)(x.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,V.jsx)(ae,{title:"Avg DSCR",value:ie.avgDSCR,subtitle:"Debt coverage ratio",color:"#7b1fa2",icon:F.A})})]}),(0,V.jsx)(u.A,{sx:{p:3,mb:3},children:(0,V.jsxs)(x.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,V.jsx)(x.Ay,{item:!0,xs:12,md:6,children:(0,V.jsx)(A.A,{fullWidth:!0,placeholder:"Search by property or lender...",value:G,onChange:e=>J(e.target.value),InputProps:{startAdornment:(0,V.jsx)(m.A,{position:"start",children:(0,V.jsx)(P.A,{})})}})}),(0,V.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,V.jsxs)(A.A,{select:!0,fullWidth:!0,label:"Loan Type",value:K,onChange:e=>Q(e.target.value),SelectProps:{native:!0},children:[(0,V.jsx)("option",{value:"",children:"All Types"}),(0,V.jsx)("option",{value:"mortgage",children:"Mortgage"}),(0,V.jsx)("option",{value:"bridge",children:"Bridge"}),(0,V.jsx)("option",{value:"mezzanine",children:"Mezzanine"}),(0,V.jsx)("option",{value:"construction",children:"Construction"}),(0,V.jsx)("option",{value:"other",children:"Other"})]})}),(0,V.jsx)(x.Ay,{item:!0,xs:12,md:3,children:(0,V.jsx)(d.A,{fullWidth:!0,variant:"outlined",startIcon:(0,V.jsx)(I.A,{}),onClick:()=>{J(""),Q("")},children:"Clear Filters"})})]})}),0===se.length?(0,V.jsxs)(u.A,{sx:{p:6,textAlign:"center"},children:[(0,V.jsx)(T.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,V.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Debt Records Found"}),(0,V.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:0===B.length?"Add your first debt record to get started.":"Try adjusting your filters to see more results."}),0===B.length&&(0,V.jsx)(d.A,{variant:"contained",startIcon:(0,V.jsx)(R.A,{}),children:"Add Debt Record"})]}):(0,V.jsxs)(u.A,{children:[(0,V.jsx)(a.A,{sx:{p:2,borderBottom:"1px solid #e0e0e0"},children:(0,V.jsxs)(l.A,{variant:"h6",sx:{fontWeight:600},children:["Debt Records (",se.length,")"]})}),(0,V.jsx)(p.A,{children:(0,V.jsxs)(y.A,{size:"small",children:[(0,V.jsx)(j.A,{children:(0,V.jsxs)(g.A,{children:[(0,V.jsx)(v.A,{sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Property"}),(0,V.jsx)(v.A,{sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Lender"}),(0,V.jsx)(v.A,{align:"right",sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Amount"}),(0,V.jsx)(v.A,{align:"right",sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Interest Rate"}),(0,V.jsx)(v.A,{sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Maturity Date"}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Days Until Maturity"}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"DSCR"}),(0,V.jsx)(v.A,{sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Loan Type"}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75,fontSize:"0.813rem",fontWeight:600},children:"Actions"})]})}),(0,V.jsx)(b.A,{children:se.map(e=>{var t,n,o;const s=ne(e.maturityDate),i=(e=>e<0?{label:"Matured",color:"default",severity:"low"}:e<180?{label:"Critical",color:"error",severity:"critical"}:e<365?{label:"Warning",color:"warning",severity:"warning"}:{label:"Healthy",color:"success",severity:"healthy"})(s);return(0,V.jsxs)(g.A,{hover:!0,children:[(0,V.jsxs)(v.A,{sx:{py:.75},children:[(0,V.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:"0.813rem"},children:(null===(t=e.Property)||void 0===t?void 0:t.name)||"Unknown Property"}),(0,V.jsx)(l.A,{variant:"caption",color:"textSecondary",sx:{fontSize:"0.688rem"},children:(null===(n=e.Property)||void 0===n?void 0:n.address)||""})]}),(0,V.jsx)(v.A,{sx:{py:.75},children:(0,V.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.813rem"},children:(null===(o=e.Lender)||void 0===o?void 0:o.name)||"Unknown Lender"})}),(0,V.jsx)(v.A,{align:"right",sx:{py:.75},children:(0,V.jsx)(l.A,{variant:"caption",sx:{fontWeight:600,fontSize:"0.813rem"},children:oe(e.amount)})}),(0,V.jsx)(v.A,{align:"right",sx:{py:.75},children:(0,V.jsxs)(l.A,{variant:"caption",sx:{fontSize:"0.813rem"},children:[parseFloat(e.interestRate).toFixed(2),"%"]})}),(0,V.jsx)(v.A,{sx:{py:.75},children:(0,V.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.813rem"},children:new Date(e.maturityDate).toLocaleDateString()})}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75},children:(0,V.jsx)(f.A,{size:"small",label:s<0?"".concat(Math.abs(s)," days ago"):"".concat(s," days"),color:i.color,variant:"outlined",sx:{height:20,fontSize:"0.688rem"}})}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75},children:(0,V.jsx)(l.A,{variant:"caption",color:e.dscr&&parseFloat(e.dscr)>=1.25?"success.main":"warning.main",sx:{fontWeight:600,fontSize:"0.813rem"},children:e.dscr?parseFloat(e.dscr).toFixed(2):"N/A"})}),(0,V.jsx)(v.A,{sx:{py:.75},children:(0,V.jsx)(f.A,{size:"small",label:(c=e.loanType,{mortgage:"Mortgage",bridge:"Bridge",mezzanine:"Mezzanine",construction:"Construction",other:"Other"}[c]||c),variant:"outlined",sx:{height:20,fontSize:"0.688rem"}})}),(0,V.jsx)(v.A,{align:"center",sx:{py:.75},children:(0,V.jsxs)(a.A,{sx:{display:"flex",gap:.25,justifyContent:"center"},children:[(0,V.jsx)(S.A,{size:"small",color:"primary",onClick:()=>r("/properties/".concat(e.propertyId)),title:"View Property",sx:{p:.5},children:(0,V.jsx)(E.A,{sx:{fontSize:16}})}),(0,V.jsx)(S.A,{size:"small",color:"primary",title:"Edit Debt",sx:{p:.5},children:(0,V.jsx)(k.A,{sx:{fontSize:16}})}),(0,V.jsx)(S.A,{size:"small",color:"error",onClick:()=>$({open:!0,debt:e}),title:"Delete Debt",sx:{p:.5},children:(0,V.jsx)(L.A,{sx:{fontSize:16}})})]})})]},e.id);var c})})]})})]}),(0,V.jsxs)(D.A,{open:Y.open,onClose:()=>$({open:!1,debt:null}),children:[(0,V.jsx)(w.A,{children:"Delete Debt Record"}),(0,V.jsx)(z.A,{children:(0,V.jsxs)(l.A,{children:["Are you sure you want to delete this debt record for"," ",(0,V.jsx)("strong",{children:(null===(e=Y.debt)||void 0===e||null===(t=e.Property)||void 0===t?void 0:t.name)||"this property"}),"? This action cannot be undone."]})}),(0,V.jsxs)(C.A,{children:[(0,V.jsx)(d.A,{onClick:()=>$({open:!1,debt:null}),children:"Cancel"}),(0,V.jsx)(d.A,{onClick:async()=>{if(Y.debt)try{await U.m.deleteDebt(Y.debt.id),_(e=>e.filter(e=>e.id!==Y.debt.id)),te({open:!0,message:"Debt record deleted successfully",severity:"success"})}catch(e){te({open:!0,message:"Failed to delete debt record",severity:"error"})}finally{$({open:!1,debt:null})}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,V.jsx)(M.A,{open:ee.open,autoHideDuration:6e3,onClose:()=>te((0,n.A)((0,n.A)({},ee),{},{open:!1})),children:(0,V.jsx)(h.A,{onClose:()=>te((0,n.A)((0,n.A)({},ee),{},{open:!1})),severity:ee.severity,sx:{width:"100%"},children:ee.message})})]})}},67957:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66734),o=r(70579);const s=(0,n.A)((0,o.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoney")},79484:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66734),o=r(70579);const s=(0,n.A)((0,o.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},79650:(e,t,r)=>{r.d(t,{A:()=>p});var n=r(58168),o=r(98587),s=r(65043),i=r(58387),a=r(98610),l=r(98206),c=r(34535),d=r(92532),h=r(72372);function x(e){return(0,h.Ay)("MuiTableContainer",e)}(0,d.A)("MuiTableContainer",["root"]);var u=r(70579);const A=["className","component"],m=(0,c.Ay)("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),p=s.forwardRef(function(e,t){const r=(0,l.b)({props:e,name:"MuiTableContainer"}),{className:s,component:c="div"}=r,d=(0,o.A)(r,A),h=(0,n.A)({},r,{component:c}),p=(e=>{const{classes:t}=e;return(0,a.A)({root:["root"]},x,t)})(h);return(0,u.jsx)(m,(0,n.A)({ref:t,as:c,className:(0,i.A)(p.root,s),ownerState:h},d))})},83560:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66734),o=r(70579);const s=(0,n.A)((0,o.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},84882:(e,t,r)=>{r.d(t,{A:()=>g});var n=r(58168),o=r(98587),s=r(65043),i=r(58387),a=r(98610),l=r(21573),c=r(98206),d=r(34535),h=r(92532),x=r(72372);function u(e){return(0,x.Ay)("MuiTableHead",e)}(0,h.A)("MuiTableHead",["root"]);var A=r(70579);const m=["className","component"],p=(0,d.Ay)("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),y={variant:"head"},j="thead",g=s.forwardRef(function(e,t){const r=(0,c.b)({props:e,name:"MuiTableHead"}),{className:s,component:d=j}=r,h=(0,o.A)(r,m),x=(0,n.A)({},r,{component:d}),g=(e=>{const{classes:t}=e;return(0,a.A)({root:["root"]},u,t)})(x);return(0,A.jsx)(l.A.Provider,{value:y,children:(0,A.jsx)(p,(0,n.A)({as:d,className:(0,i.A)(g.root,s),ref:t,role:d===j?null:"rowgroup",ownerState:x},h))})})}}]);
//# sourceMappingURL=8216.b7940dc5.chunk.js.map