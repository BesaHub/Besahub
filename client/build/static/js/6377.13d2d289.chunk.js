"use strict";(self.webpackChunkcre_crm_client=self.webpackChunkcre_crm_client||[]).push([[6377],{16377:(e,s,t)=>{t.r(s),t.d(s,{default:()=>F});var n=t(65043),a=t(73216),i=t(19252),r=t(81637),o=t(85865),d=t(67254),c=t(63336),l=t(96446),x=t(12110),u=t(26494),h=t(43845),m=t(39336),A=t(68903),b=t(11906),p=t(83462),j=t(26600),y=t(35316),v=t(67784),g=t(29347),f=t(98606),k=t(93234),C=t(73835),w=t(34642),M=t(94505),W=t(70579);const F=()=>{var e;const s=(0,a.Zp)(),[t,F]=(0,n.useState)(!0),[S,R]=(0,n.useState)(null),[E,G]=(0,n.useState)(""),[z,L]=(0,n.useState)(""),[B,N]=(0,n.useState)(!1),[D,P]=(0,n.useState)(!1),[T,U]=(0,n.useState)(""),[I,V]=(0,n.useState)([]),[_,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{O()},[]);const O=async()=>{try{F(!0),G("");const e=await M.Ay.get("/mfa/status");R(e.data)}catch(e){console.error("Error fetching MFA status:",e),G("Failed to load MFA status")}finally{F(!1)}},q=()=>{P(!1),V([]),U("")};return t?(0,W.jsxs)(i.A,{maxWidth:"md",sx:{py:4,textAlign:"center"},children:[(0,W.jsx)(r.A,{size:60}),(0,W.jsx)(o.A,{variant:"h6",sx:{mt:2},children:"Loading MFA settings..."})]}):S?(0,W.jsxs)(i.A,{maxWidth:"md",sx:{py:4},children:[(0,W.jsxs)(c.A,{elevation:3,sx:{p:4},children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,W.jsx)(k.A,{sx:{fontSize:40,color:"primary.main",mr:2}}),(0,W.jsxs)(l.A,{children:[(0,W.jsx)(o.A,{variant:"h4",children:"Multi-Factor Authentication"}),(0,W.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Add an extra layer of security to your account"})]})]}),E&&(0,W.jsx)(d.A,{severity:"error",sx:{mb:3},onClose:()=>G(""),children:E}),z&&(0,W.jsx)(d.A,{severity:"success",sx:{mb:3},onClose:()=>L(""),children:z}),(0,W.jsx)(x.A,{variant:"outlined",sx:{mb:3},children:(0,W.jsxs)(u.A,{children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,W.jsx)(o.A,{variant:"h6",children:"MFA Status"}),S.mfaEnabled?(0,W.jsx)(h.A,{label:"Enabled",color:"success",icon:(0,W.jsx)(f.A,{})}):(0,W.jsx)(h.A,{label:"Disabled",color:"default",icon:(0,W.jsx)(w.A,{})})]}),(0,W.jsx)(m.A,{sx:{my:2}}),(0,W.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,W.jsxs)(A.Ay,{item:!0,xs:12,sm:6,children:[(0,W.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Role:"}),(0,W.jsx)(o.A,{variant:"body1",fontWeight:"bold",children:null===(e=S.role)||void 0===e?void 0:e.toUpperCase()})]}),S.mfaEnabled&&(0,W.jsxs)(A.Ay,{item:!0,xs:12,sm:6,children:[(0,W.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Backup Codes Remaining:"}),(0,W.jsx)(o.A,{variant:"body1",fontWeight:"bold",children:S.backupCodesRemaining||0})]})]})]})}),!S.canEnableMfa&&(0,W.jsx)(d.A,{severity:"info",sx:{mb:3},children:"MFA is only available for Admin and Manager roles"}),S.canEnableMfa&&!S.mfaEnabled&&(0,W.jsxs)(l.A,{children:[(0,W.jsxs)(d.A,{severity:"warning",sx:{mb:3},children:[(0,W.jsx)(o.A,{variant:"body2",fontWeight:"bold",children:"MFA is recommended for Admin and Manager accounts"}),(0,W.jsx)(o.A,{variant:"body2",children:"Enable two-factor authentication to add an extra layer of security to your account"})]}),(0,W.jsx)(b.A,{variant:"contained",size:"large",startIcon:(0,W.jsx)(k.A,{}),onClick:()=>{s("/mfa/setup")},fullWidth:!0,children:"Enable Multi-Factor Authentication"})]}),S.mfaEnabled&&(0,W.jsxs)(l.A,{children:[(0,W.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Manage MFA Settings"}),(0,W.jsxs)(A.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,W.jsx)(A.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(b.A,{variant:"outlined",fullWidth:!0,startIcon:(0,W.jsx)(C.A,{}),onClick:()=>P(!0),disabled:_,children:"Regenerate Backup Codes"})}),(0,W.jsx)(A.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(b.A,{variant:"outlined",color:"error",fullWidth:!0,onClick:()=>N(!0),disabled:_,children:"Disable MFA"})})]}),S.backupCodesRemaining<=2&&(0,W.jsxs)(d.A,{severity:"warning",sx:{mt:3},children:["You have ",S.backupCodesRemaining," backup codes remaining. Consider regenerating them."]})]})]}),(0,W.jsxs)(p.A,{open:B,onClose:()=>N(!1),children:[(0,W.jsx)(j.A,{children:"Disable Multi-Factor Authentication"}),(0,W.jsxs)(y.A,{children:[(0,W.jsx)(d.A,{severity:"warning",sx:{mb:2},children:"This will remove the extra security layer from your account"}),(0,W.jsx)(o.A,{variant:"body2",sx:{mb:2},children:"Enter your password to confirm:"}),(0,W.jsx)(v.A,{label:"Password",type:"password",fullWidth:!0,value:T,onChange:e=>U(e.target.value),autoFocus:!0})]}),(0,W.jsxs)(g.A,{children:[(0,W.jsx)(b.A,{onClick:()=>N(!1),disabled:_,children:"Cancel"}),(0,W.jsx)(b.A,{onClick:async()=>{if(T)try{H(!0),G(""),await M.Ay.post("/mfa/disable",{password:T}),L("MFA has been disabled for your account"),N(!1),U(""),O()}catch(t){var e,s;console.error("Error disabling MFA:",t),G((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.error)||"Failed to disable MFA")}finally{H(!1)}else G("Password is required")},color:"error",variant:"contained",disabled:_||!T,children:_?(0,W.jsx)(r.A,{size:24}):"Disable MFA"})]})]}),(0,W.jsxs)(p.A,{open:D,onClose:q,maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(j.A,{children:"Regenerate Backup Codes"}),(0,W.jsx)(y.A,{children:0===I.length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(d.A,{severity:"warning",sx:{mb:2},children:"This will invalidate all existing backup codes and generate new ones"}),(0,W.jsx)(o.A,{variant:"body2",sx:{mb:2},children:"Enter your password to confirm:"}),(0,W.jsx)(v.A,{label:"Password",type:"password",fullWidth:!0,value:T,onChange:e=>U(e.target.value),autoFocus:!0})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(d.A,{severity:"success",sx:{mb:2},children:"New backup codes generated successfully!"}),(0,W.jsx)(o.A,{variant:"body2",sx:{mb:2},children:"Save these codes in a secure location. Each code can only be used once."}),(0,W.jsx)(A.Ay,{container:!0,spacing:1,children:I.map((e,s)=>(0,W.jsx)(A.Ay,{item:!0,xs:6,children:(0,W.jsx)(c.A,{sx:{p:1.5,textAlign:"center",fontFamily:"monospace",bgcolor:"grey.50"},children:e})},s))})]})}),(0,W.jsx)(g.A,{children:0===I.length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(b.A,{onClick:q,disabled:_,children:"Cancel"}),(0,W.jsx)(b.A,{onClick:async()=>{if(T)try{H(!0),G("");const e=await M.Ay.post("/mfa/backup-codes/generate",{password:T});V(e.data.backupCodes),L("New backup codes generated successfully"),U(""),O()}catch(t){var e,s;console.error("Error regenerating backup codes:",t),G((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.error)||"Failed to generate backup codes")}finally{H(!1)}else G("Password is required")},variant:"contained",disabled:_||!T,children:_?(0,W.jsx)(r.A,{size:24}):"Generate New Codes"})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(b.A,{onClick:()=>{const e="BesaHubs CRM - MFA Backup Codes\n\n".concat(I.join("\n"),"\n\nSave these codes in a secure location. Each code can only be used once."),s=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download="besahubs-mfa-backup-codes.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},variant:"outlined",children:"Download Codes"}),(0,W.jsx)(b.A,{onClick:q,variant:"contained",children:"Done"})]})})]})]}):(0,W.jsx)(i.A,{maxWidth:"md",sx:{py:4},children:(0,W.jsx)(d.A,{severity:"error",children:"Failed to load MFA settings"})})}},19252:(e,s,t)=>{t.d(s,{A:()=>f});var n=t(98587),a=t(58168),i=t(65043),r=t(58387),o=t(72372),d=t(98610),c=t(67598),l=t(52900),x=t(46060),u=t(18280),h=t(70579);const m=["className","component","disableGutters","fixed","maxWidth","classes"],A=(0,u.A)(),b=(0,x.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:t}=e;return[s.root,s["maxWidth".concat((0,c.A)(String(t.maxWidth)))],t.fixed&&s.fixed,t.disableGutters&&s.disableGutters]}}),p=e=>(0,l.A)({props:e,name:"MuiContainer",defaultTheme:A});var j=t(6803),y=t(34535),v=t(98206);const g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:s=b,useThemeProps:t=p,componentName:l="MuiContainer"}=e,x=s(e=>{let{theme:s,ownerState:t}=e;return(0,a.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!t.disableGutters&&{paddingLeft:s.spacing(2),paddingRight:s.spacing(2),[s.breakpoints.up("sm")]:{paddingLeft:s.spacing(3),paddingRight:s.spacing(3)}})},e=>{let{theme:s,ownerState:t}=e;return t.fixed&&Object.keys(s.breakpoints.values).reduce((e,t)=>{const n=t,a=s.breakpoints.values[n];return 0!==a&&(e[s.breakpoints.up(n)]={maxWidth:"".concat(a).concat(s.breakpoints.unit)}),e},{})},e=>{let{theme:s,ownerState:t}=e;return(0,a.A)({},"xs"===t.maxWidth&&{[s.breakpoints.up("xs")]:{maxWidth:Math.max(s.breakpoints.values.xs,444)}},t.maxWidth&&"xs"!==t.maxWidth&&{[s.breakpoints.up(t.maxWidth)]:{maxWidth:"".concat(s.breakpoints.values[t.maxWidth]).concat(s.breakpoints.unit)}})}),u=i.forwardRef(function(e,s){const i=t(e),{className:u,component:A="div",disableGutters:b=!1,fixed:p=!1,maxWidth:j="lg"}=i,y=(0,n.A)(i,m),v=(0,a.A)({},i,{component:A,disableGutters:b,fixed:p,maxWidth:j}),g=((e,s)=>{const{classes:t,fixed:n,disableGutters:a,maxWidth:i}=e,r={root:["root",i&&"maxWidth".concat((0,c.A)(String(i))),n&&"fixed",a&&"disableGutters"]};return(0,d.A)(r,e=>(0,o.Ay)(s,e),t)})(v,l);return(0,h.jsx)(x,(0,a.A)({as:A,ownerState:v,className:(0,r.A)(g.root,u),ref:s},y))});return u}({createStyledComponent:(0,y.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:t}=e;return[s.root,s["maxWidth".concat((0,j.A)(String(t.maxWidth)))],t.fixed&&s.fixed,t.disableGutters&&s.disableGutters]}}),useThemeProps:e=>(0,v.b)({props:e,name:"MuiContainer"})}),f=g},73835:(e,s,t)=>{t.d(s,{A:()=>i});var n=t(66734),a=t(70579);const i=(0,n.A)((0,a.jsx)("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"VpnKey")},93234:(e,s,t)=>{t.d(s,{A:()=>i});var n=t(66734),a=t(70579);const i=(0,n.A)((0,a.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security")}}]);
//# sourceMappingURL=6377.13d2d289.chunk.js.map